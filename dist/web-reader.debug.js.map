{"version":3,"sources":["node_modules/browser-pack/_prelude.js","lang/en-GB.json","node_modules/damerau-levenshtein/damerau-levenshtein.js","src/commands.js","src/dom/document.js","src/dom/dom.js","src/dom/headers.js","src/dom/links.js","src/dom/main.js","src/helpers/event-emitter.js","src/helpers/timer.js","src/main.js","src/reader/recognizer.js","src/reader/speaker.js","src/router.js","src/webreader-error.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAC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","file":"web-reader.debug.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","module.exports={\n   \"commands\": {\n      \"READ_ALL_HEADERS\": {\n         \"text\": \"read all headers\",\n         \"variations\": [\n            \"read headers\",\n            \"read all the headers\"\n         ]\n      },\n      \"READ_ALL_LINKS\": {\n         \"text\": \"read all links\",\n         \"variations\": [\n            \"read links\",\n            \"read all the links\"\n         ]\n      },\n      \"READ_LEVEL_HEADERS\": {\n         \"text\": \"read all h\",\n         \"variations\": [\n            \"read h\",\n            \"read all the h\"\n         ],\n         \"levels\": [\n            \"one\",\n            \"two\",\n            \"three\",\n            \"four\",\n            \"five\",\n            \"six\"\n         ]\n      },\n      \"READ_MAIN\": {\n         \"text\": \"read main content\",\n         \"variations\": [\n            \"read the main\",\n            \"read the main content\"\n         ]\n      },\n      \"SEARCH_MAIN\": {\n         \"text\": \"search main content\",\n         \"variations\": [\n            \"search the main\",\n            \"search the main content\",\n            \"find main content\",\n            \"find the main\",\n            \"find the main content\"\n         ]\n      },\n      \"READ_AGAIN\": {\n         \"text\": \"read element again\",\n         \"variations\": [\n            \"read the current element again\",\n            \"read again\"\n         ]\n      },\n      \"READ_PREVIOUS\": {\n         \"text\": \"read previous element\",\n         \"variations\": [\n            \"read previous\"\n         ]\n      },\n      \"READ_NEXT\": {\n         \"text\": \"read next element\",\n         \"variations\": [\n            \"read next\"\n         ]\n      },\n      \"READ_PAGE_TITLE\": {\n         \"text\": \"read page title\",\n         \"variations\": [\n            \"read title\",\n            \"read the title of the page\",\n            \"read document title\"\n         ]\n      },\n      \"READ_LINKS_IN_ELEMENT\": {\n         \"text\": \"read links inside\",\n         \"variations\": [\n            \"read links contained\",\n            \"read links contained in\",\n            \"read all links inside\",\n            \"read all links contained\",\n            \"read all links contained in\"\n         ]\n      },\n      \"GO_TO_PREVIOUS_PAGE\": {\n         \"text\": \"previous page\",\n         \"variations\": [\n            \"go to previous page\"\n         ]\n      },\n      \"GO_TO_NEXT_PAGE\": {\n         \"text\": \"next page\",\n         \"variations\": [\n            \"go to next page\"\n         ]\n      },\n      \"READ_PAGE_SUMMARY\": {\n         \"text\": \"read page summary\",\n         \"variations\": [\n            \"summarize page\",\n            \"summarize the page\"\n         ]\n      },\n      \"GO_TO_HOMEPAGE\": {\n         \"text\": \"homepage\",\n         \"variations\": [\n            \"go to homepage\"\n         ]\n      },\n      \"GO_TO_LINK\": {\n         \"text\": \"go to link\",\n         \"variations\": [\n            \"follow link\",\n            \"go\",\n            \"go there\"\n         ]\n      }\n   },\n   \"elements\": {\n      \"MAIN\": {\n         \"selector\": \"main\",\n         \"variations\": [\n            \"main\"\n         ]\n      },\n      \"NAV\": {\n         \"selector\": \"nav\",\n         \"variations\": [\n            \"nav\",\n            \"navigation\",\n            \"menu\"\n         ]\n      },\n      \"HEADER\": {\n         \"selector\": \"header\",\n         \"variations\": [\n            \"header\"\n         ]\n      },\n      \"FOOTER\": {\n         \"selector\": \"footer\",\n         \"variations\": [\n            \"footer\"\n         ]\n      }\n   }\n}","function DamerauLevenshtein (prices, damerau) {\n    // 'prices' customisation of the edit costs by passing an\n    // object with optional 'insert', 'remove', 'substitute', and\n    // 'transpose' keys, corresponding to either a constant\n    // number, or a function that returns the cost. The default\n    // cost for each operation is 1. The price functions take\n    // relevant character(s) as arguments, should return numbers,\n    // and have the following form:\n    //\n    // insert: function (inserted) { return NUMBER; }\n    //\n    // remove: function (removed) { return NUMBER; }\n    //\n    // substitute: function (from, to) { return NUMBER; }\n    //\n    // transpose: function (backward, forward) { return NUMBER; }\n    //\n    // The damerau flag allows us to turn off transposition and\n    // only do plain Levenshtein distance.\n\n    if (damerau !== false) damerau = true;\n    if (!prices) prices = {};\n    var insert, remove, substitute, transpose;\n\n    switch (typeof prices.insert) {\n    case 'function': insert = prices.insert; break;\n    case 'number': insert = function (c) { return prices.insert; }; break;\n    default: insert = function (c) { return 1; }; break; }\n\n    switch (typeof prices.remove) {\n    case 'function': remove = prices.remove; break;\n    case 'number': remove = function (c) { return prices.remove; }; break;\n    default: remove = function (c) { return 1; }; break; }\n\n    switch (typeof prices.substitute) {\n    case 'function': substitute = prices.substitute; break;\n    case 'number':\n        substitute = function (from, to) { return prices.substitute; };\n        break;\n    default: substitute = function (from, to) { return 1; }; break; }\n\n    switch (typeof prices.transpose) {\n    case 'function': transpose = prices.transpose; break;\n    case 'number':\n        transpose = function (backward, forward) { return prices.transpose; };\n        break;\n    default: transpose = function (backward, forward) { return 1; }; break; }\n\n    function distance(down, across) {\n        // http://en.wikipedia.org/wiki/Damerau%E2%80%93Levenshtein_distance\n        var ds = [];\n        if ( down === across ) {\n            return 0;\n        } else {\n            down = down.split(''); down.unshift(null);\n            across = across.split(''); across.unshift(null);\n            down.forEach(function (d, i) {\n                if (!ds[i]) ds[i] = [];\n                across.forEach(function (a, j) {\n                    if (i === 0 && j === 0) ds[i][j] = 0;\n                    // Empty down (i == 0) -> across[1..j] by inserting\n                    else if (i === 0) ds[i][j] = ds[i][j-1] + insert(a);\n                    // Down -> empty across (j == 0) by deleting\n                    else if (j === 0) ds[i][j] = ds[i-1][j] + remove(d);\n                    else {\n                        // Find the least costly operation that turns\n                        // the prefix down[1..i] into the prefix\n                        // across[1..j] using already calculated costs\n                        // for getting to shorter matches.\n                        ds[i][j] = Math.min(\n                            // Cost of editing down[1..i-1] to\n                            // across[1..j] plus cost of deleting\n                            // down[i] to get to down[1..i-1].\n                            ds[i-1][j] + remove(d),\n                            // Cost of editing down[1..i] to\n                            // across[1..j-1] plus cost of inserting\n                            // across[j] to get to across[1..j].\n                            ds[i][j-1] + insert(a),\n                            // Cost of editing down[1..i-1] to\n                            // across[1..j-1] plus cost of\n                            // substituting down[i] (d) with across[j]\n                            // (a) to get to across[1..j].\n                            ds[i-1][j-1] + (d === a ? 0 : substitute(d, a))\n                        );\n                        // Can we match the last two letters of down\n                        // with across by transposing them? Cost of\n                        // getting from down[i-2] to across[j-2] plus\n                        // cost of moving down[i-1] forward and\n                        // down[i] backward to match across[j-1..j].\n                        if (damerau\n                            && i > 1 && j > 1\n                            && down[i-1] === a && d === across[j-1]) {\n                            ds[i][j] = Math.min(\n                                ds[i][j],\n                                ds[i-2][j-2] + (d === a ? 0 : transpose(d, down[i-1]))\n                            );\n                        };\n                    };\n                });\n            });\n            return ds[down.length-1][across.length-1];\n        };\n    };\n    return distance;\n};\n\nmodule.exports = DamerauLevenshtein;\n","import DamerauLevenshtein from 'damerau-levenshtein';\n\n/**\n * The translation currently in use\n *\n * @type {Object}\n */\nlet translation = null;\n\n/**\n * @typedef CommandsHash\n * @type {Object}\n * @property {string} command The command recognized\n * @property {string} [translationsPath=''] The path to the translations folder\n * @property {Object} [recognizer] The settings for the speech recognition functionality\n */\n\n/**\n * Finds the closest match of a string using the Damerau-Levenshtein algorithm\n *\n * @param {(string|string[])} string The string or the array of strings to test\n * @param {string} target The string to test against\n *\n * @return {Object}\n */\nfunction findCloserMatch(string, target) {\n   if (!Array.isArray(string)) {\n      string = [string];\n   }\n\n   let damerauLevenshtein = DamerauLevenshtein(); // jshint ignore:line\n   let minDistance = Number.POSITIVE_INFINITY;\n   let i;\n\n   for(i = 0; i < string.length; i++) {\n      let distance = damerauLevenshtein(string[i], target);\n\n      console.debug(`The distance between \"${string[i]}\" and \"${target}\" is ${distance}`);\n\n      // If a perfect match is found, exit immediately\n      if (distance === 0) {\n         minDistance = distance;\n         break;\n      } else if (distance < minDistance) {\n         minDistance = distance;\n      }\n   }\n\n   return {\n      index: i === string.length ? -1 : i,\n      distance: minDistance\n   };\n}\n\n/**\n * Extracts the heading level contained in the string provided.\n * If a perfect match is not found, the Damerau-Levenshtein algorithm\n * is used to find the closest match.\n *\n * @param {string} recognizedText The string to analyze\n *\n * @return {Object}\n */\nfunction extractHeaderLevel(recognizedText) {\n   const headingLevels = translation.commands.READ_LEVEL_HEADERS.levels;\n   let data = {};\n\n   for(let i = 0; i < headingLevels.length; i++) {\n      let regexp = new RegExp(`(^|\\\\b)(${i + 1}|h${i + 1}|${headingLevels[i]})(\\\\b|$)`, 'i');\n\n      if (regexp.test(recognizedText)) {\n         data.level = i + 1;\n         break;\n      }\n   }\n\n   // If the header level has not been found yet,\n   // let's try a more heuristic strategy\n   if (!data.level) {\n      let closerMatchIndex = findCloserMatch(headingLevels, recognizedText).index;\n\n      data.level = closerMatchIndex === -1 ? -1 : closerMatchIndex + 1;\n   }\n\n   return data;\n}\n\n/**\n * Searches an element type, such as <code>main</code> or <code>footer</code>,\n * in the text provided. If none is found, <code>null</code> is returned\n *\n * @param {string} recognizedText The string to analyze\n *\n * @return {HTMLElement|null}\n */\nfunction findElementInText(recognizedText) {\n   let elements = translation.elements;\n   let foundElement = null;\n\n   for(let key in elements) {\n      let variations = elements[key].variations.join('|');\n      let regexp = new RegExp(`(^|\\\\b)(${variations})(\\\\b|$)`, 'i');\n\n      if (regexp.test(recognizedText)) {\n         foundElement = document.querySelector(elements[key].selector);\n         break;\n      }\n   }\n\n   return foundElement;\n}\n/**\n * Searches an element type, such as <code>main</code> or <code>footer</code>,\n * in the text provided. If none is found, the closest match is re is returned\n *\n * @param {string} recognizedText The string to analyze\n *\n * @return {Object}\n */\nfunction extractElementFromText(recognizedText) {\n   let foundElement = findElementInText(recognizedText);\n\n   if (foundElement) {\n      return {\n         element: foundElement\n      };\n   }\n\n   // Collects the closer match for each element.\n   let closerMatches = [];\n   let elements = translation.elements;\n\n   // If the element has not been found yet,\n   // let's try a more heuristic strategy\n   for(let key in elements) {\n      let variations = elements[key].variations;\n      let closerMatchIndex = findCloserMatch(variations, recognizedText);\n\n      if (closerMatchIndex !== -1) {\n         closerMatches.push(variations[closerMatchIndex]);\n      }\n   }\n\n   // Find the closest match among the closest match\n   let closestMatch = findCloserMatch(closerMatches, recognizedText);\n\n   return {\n      element: closestMatch.index >= 0 ? closerMatches[closestMatch.index] : null\n   };\n}\n\n/**\n * Extracts relevant data from a string, based on the recognized command\n *\n * @param {string} command The recognized command\n * @param {string} recognizedText The string from which the data are extracted\n *\n * @return {Object}\n */\nfunction extractData(command, recognizedText) {\n   let data = {};\n\n   if (command === 'READ_LEVEL_HEADERS') {\n      console.debug('Extracting header level from text');\n      data = extractHeaderLevel(recognizedText);\n   } else if (command === 'READ_LINKS_IN_ELEMENT') {\n      console.debug('Extracting element from text');\n      data = extractElementFromText(recognizedText);\n   }\n\n   return data;\n}\n\n/**\n * Detects the action to perform and extracts any relevant data\n * based on the string provided\n *\n * @param {string} recognizedText The string to analyze\n * @param {Object} currentTranslation The object containing the translation of the application\n *\n * @return {CommandsHash}\n */\nexport\n\n function recognizeCommand(recognizedText, currentTranslation) {\n   let minDistance = Number.POSITIVE_INFINITY;\n   let commands = currentTranslation.commands;\n   let foundCommand;\n\n   translation = currentTranslation;\n   recognizedText = recognizedText.toLocaleLowerCase();\n\n   console.debug('Command recognition started');\n\n   for(let command in commands) {\n      let closerMatch = findCloserMatch(\n         [commands[command].text].concat(commands[command].variations),\n         recognizedText\n      );\n\n      if (closerMatch.distance < minDistance) {\n         foundCommand = Object.assign(\n            {\n               command: command\n            },\n            extractData(command, recognizedText)\n         );\n\n         if (closerMatch.distance === 0) {\n            break;\n         } else {\n            minDistance = closerMatch.distance;\n         }\n      }\n   }\n\n   console.debug(`Command recognition ended. Found command \"${commands[foundCommand.command].text}\"`);\n   console.debug('Extrapolated data:', foundCommand);\n\n   return foundCommand;\n}","/**\n * Returns the title of the current document\n *\n * @return {string}\n */\nfunction getTitle() {\n   return document.title;\n}\n\nexport {\n   getTitle\n}","import {getTitle} from './document'\nimport {getHeaders} from './headers'\nimport {getLinks} from './links'\nimport {getMain} from './main'\n\n/**\n * Highlights an element in the current document by wrapping it\n * with a <code>mark</code> element\n *\n * @param {HTMLElement} element The element to highlight\n */\nfunction highlightElement(element) {\n   if (!element instanceof HTMLElement) {\n      return;\n   }\n\n   element.innerHTML = `<mark>${element.innerHTML}</mark>`;\n}\n\n/**\n * Unhighlights an element in the current document by removing\n * the <code>mark</code> element wrapping it\n *\n * @param {HTMLElement} element The element to unhighlight\n */\nfunction unhighlightElement(element) {\n   if (!element instanceof HTMLElement) {\n      return;\n   }\n\n   element.innerHTML = element.innerHTML\n      .replace(/^<mark>/, '')\n      .replace(/<\\/mark>$/, '');\n}\n\nexport default {\n   getHeaders,\n   getLinks,\n   getMain,\n   getTitle,\n   highlightElement,\n   unhighlightElement\n};","/**\n * Returns the level of a header (1 for an <code>h1</code>, 2 for an <code>h2</code>,\n * and so on). If the element is not an header or it is not defined, zero is returned\n *\n * @param {HTMLElement} element\n *\n * @return {number}\n */\nfunction getHeaderLevel(element) {\n   if (!element || !element.nodeName || element.nodeName.toLowerCase().indexOf('h') !== 0) {\n      return 0;\n   }\n\n   return parseInt(element.nodeName.charAt(1), 10);\n}\n\n/**\n * Returns all the headers of a page in a tree structure. Each element\n * possesses two properties: element and subheadings. The former\n * is an <code>HTMLElement</code> referencing the header, while the latter is an array\n * containing all the subheadings of the header.\n *\n * @return {Object[]}\n */\nfunction createHeadingsStructure(headers) {\n   let tree = [];\n\n   (function recurse(headers, index, tree) {\n      if (headers.length === 0 || index.index === headers.length) {\n         return tree;\n      }\n\n      let headerLevel = getHeaderLevel(headers[index.index]);\n      let header = {\n         element: headers[index.index],\n         subheadings: []\n      };\n\n      if (tree.length === 0 || headerLevel === getHeaderLevel(tree[tree.length - 1].element)) {\n         tree.push(header);\n         index.index++;\n\n         return recurse(headers, index, tree);\n      }\n\n      if (headerLevel > getHeaderLevel(tree[tree.length - 1].element)) {\n         tree[tree.length - 1].subheadings = recurse(headers, index, []);\n      }\n\n      headerLevel = getHeaderLevel(headers[index.index]);\n\n      if (headerLevel === getHeaderLevel(tree[tree.length - 1].element)) {\n         return recurse(headers, index, tree);\n      } else {\n         return tree;\n      }\n   })(headers, {index: 0}, tree);\n}\n\n/**\n * Returns all the headers of a page, optionally filtered\n *\n * @param {Object} [filters={}] An object used to filters the headers to return\n * @param {number} [filters.level=-1] An integer that specifies the level to retrieve.\n * If set  to -1 retrieves all the headers\n * @param {string} [filters.text=''] A string that must be contained in the header's text\n *\n * @return {HTMLElement[]}\n */\nfunction getHeaders(filters = {}) {\n   let selector;\n\n   filters = Object.assign(\n      {\n         level: -1,\n         text: ''\n      },\n      filters\n   );\n\n   if (filters.level === -1) {\n      selector = 'h1, h2, h3, h4, h5, h6';\n   } else {\n      selector = `h${filters.level}`;\n   }\n\n   let filterTextRegExp = new RegExp(`(^|\\\\b)${filters.text}(\\\\b|$)`, 'i');\n   let headers = Array\n      .from(document.querySelectorAll(selector))\n      .filter(header => header.textContent.search(filterTextRegExp) >= 0);\n\n   return headers;\n}\n\nexport {\n   createHeadingsStructure,\n   getHeaders\n}","/**\n * Determines if a link would be read or not by a classic screen reader\n *\n * @param {HTMLElement} element The element to test\n *\n * @return {boolean}\n */\nfunction isScreenReaderVisible(element) {\n   return window.getComputedStyle(element).display !== 'none' &&\n          element.getAttribute('aria-hidden') !== 'true';\n}\n\n/**\n * Returns all the links of a page, optionally filtered\n *\n * @param {Object} [filters={}] An object used to filters the links\n * @param {(HTMLElement|HTMLDocument)} [filters.ancestor=document] The ancestor of the links to retrieve\n *\n * @return {HTMLElement[]}\n */\nfunction getLinks(filters = {}) {\n   filters = Object.assign(\n      {\n         ancestor: document\n      },\n      filters\n   );\n\n   let links = filters.ancestor.querySelectorAll('a');\n\n   return Array\n      .from(links)\n      .filter(element => isScreenReaderVisible(element));\n}\n\nexport {\n   getLinks\n}","/**\n * Returns the main element of the page.\n * If the element is not found, an heuristic is employed to find a possible\n * main element. If the heuristic approach fails, <code>null</code> is returned\n *\n * @return {HTMLElement|null}\n */\nfunction getMain() {\n   let main = document.querySelector('main') ||\n              document.querySelector('[role=\"main\"]');\n\n   // If a main has not been found, let's use an heuristic to find\n   // a possible main content that has not been marked as such.\n   if (!main) {\n      let possibleMain = document.querySelectorAll('#main-content, .main-content, #main, .main');\n\n      // If only one element is found, it's highly possible\n      // that it's the true main content of the page.\n      if (possibleMain.length === 1) {\n         main = possibleMain[0];\n      }\n   }\n\n   return main;\n}\n\nexport {\n   getMain\n}","/**\n * The class representing an event emitter\n *\n * @class\n */\nexport\n   default class EventEmitter {\n   /**\n    * Returns the namespace of the events\n    *\n    * @return {string}\n    */\n   static get namespace() {\n      return 'webreader';\n   }\n\n   /**\n    * Namespaces an event\n    *\n    * @param {string} eventName The event name\n    *\n    * @return {string}\n    */\n   static namespaceEvent(eventName) {\n      return `${EventEmitter.namespace}.${eventName}`;\n   }\n\n   /**\n    * Fires an event\n    *\n    * @param {string} eventName The name of the event\n    * @param {HTMLElement|Document} element The element on which the event is dispatched\n    * @param {Object} [properties] A set of key-values to assign to the event\n    */\n   static fireEvent(eventName, element, properties) {\n      let customEvent = document.createEvent('Event');\n\n      customEvent.initEvent(eventName, true, true);\n\n      for (let property in properties) {\n         if (properties.hasOwnProperty(property)) {\n            try {\n               customEvent[property] = properties[property];\n            } catch (ex) {\n               console.debug(`Properties ${property} cannot be copied`);\n            }\n         }\n      }\n\n      element.dispatchEvent(customEvent);\n   }\n}","/**\n * The class representing a timer\n *\n * @class\n */\nexport\n   default class Timer {\n   /**\n    * Waits for the amount of milliseconds specified\n    *\n    * @param {number} milliseconds The amount of milliseconds to wait\n    *\n    * @return {Promise}\n    */\n   static wait(milliseconds) {\n      return new Promise(resolve => window.setTimeout(resolve, milliseconds));\n   }\n}","import * as Commands from './commands';\nimport Dom from './dom/dom';\nimport Recognizer from './reader/recognizer';\nimport Router from './router';\nimport Speaker from './reader/speaker';\nimport EventEmitter from './helpers/event-emitter';\nimport Timer from './helpers/timer';\nimport WebReaderError from './webreader-error';\nimport defaultTranslation from '../lang/en-GB.json';\n\nconst defaultLanguage = 'en-GB';\n\n/**\n * @typedef SettingsHash\n * @type {Object}\n * @property {number} [delay=300] The delay between each spoken text\n * @property {string} [translationsPath=''] The path to the translations folder\n * @property {SpeechRecognitionHash} [recognizer] The settings for the speech recognition functionality\n * @property {SpeechSynthesisUtteranceHash} [speaker] The settings for the speech synthesis functionality\n * functionality\n */\n\n/**\n * The default values for the settings available\n *\n * @type {SettingsHash}\n */\nconst defaults = {\n   delay: 300,\n   translationsPath: '',\n   recognizer: {\n      lang: defaultLanguage\n   },\n   speaker: {\n      lang: defaultLanguage,\n      voice: 'Google UK English Female'\n   }\n};\n\nconst defaultState = {\n   isInteracting: false,\n   elements: null,\n   currentIndex: -1\n};\n\nlet eventListenersMap = new WeakMap();\nlet statusMap = new WeakMap();\nlet translations = new Map([[defaultLanguage, defaultTranslation]]);\n\n/**\n * Downloads a translation for the commands available\n *\n * @param {string} translationsPath The path to the translations folder\n * @param {string} language The language to download\n *\n * @return {Promise}\n */\nfunction downloadTranslation(translationsPath, language) {\n   return window\n      .fetch(`${translationsPath}/${language}.json`)\n      .then(response => response.json())\n      .then(response => {\n         translations.set(language, response);\n\n         return response;\n      });\n}\n\n/**\n * Performs certain actions based on the shortcuts pressed by the user\n *\n * @param {WebReader} webReader An instance of WebReader\n * @param {Event} event An event\n */\nfunction listenShortcuts(webReader, event) {\n   if (\n      event.ctrlKey === true &&\n      (event.code && event.code === 'Space' || event.which === 32)\n   ) {\n      if (webReader.isInteracting()) {\n         let state = statusMap.get(webReader);\n\n         if (state.elements) {\n            Dom.unhighlightElement(state.elements[state.currentIndex]);\n         }\n\n         webReader.stopCommand();\n      } else {\n         webReader.receiveCommand();\n      }\n   }\n}\n\n/**\n * The class representing the library\n *\n * @class\n */\nexport\n   default class WebReader {\n   /**\n    * Creates an instance of WebReader\n    *\n    * @constructor\n    *\n    * @param {SettingsHash} [options={}] The options to customize WebReader\n    */\n   constructor(options = {}) {\n      /**\n       * @type {Object}\n       */\n      this.settings = Object.assign({}, defaults, options);\n      /**\n       *\n       * @type {Recognizer}\n       */\n      this.recognizer = new Recognizer(this.settings.recognizer);\n      /**\n       *\n       * @type {Speaker}\n       */\n      this.speaker = new Speaker(this.settings.speaker);\n\n      statusMap.set(this, Object.assign({}, defaultState));\n      eventListenersMap.set(this, new Map());\n\n      let language = this.settings.recognizer.lang;\n\n      if (language && !translations.has(language)) {\n         downloadTranslation(this.settings.translationsPath, language)\n            .then(\n               () => {\n                  let message = `Language \"${language}\" successfully loaded`;\n\n                  console.debug(message);\n\n                  EventEmitter.fireEvent(`${EventEmitter.namespace}.languagedownload`, document, {\n                     data: {\n                        lang: language\n                     }\n                  });\n\n                  return this.speaker.speak(message);\n               },\n               err => {\n                  console.debug(err.message);\n\n                  EventEmitter.fireEvent(`${EventEmitter.namespace}.languageerror`, document, {\n                     data: {\n                        lang: language\n                     }\n                  });\n\n                  return this.speaker.speak(`An error occurred: the language \"${language}\" was not loaded`);\n               }\n            );\n      }\n   }\n\n   /**\n    * Determines if WebReader is currently interacting with the user\n    *\n    * @return {boolean}\n    */\n   isInteracting() {\n      return statusMap.get(this).isInteracting;\n   }\n\n   /**\n    * Enables the keyboard shortcuts provided\n    *\n    * @return {WebReader}\n    */\n   enableShortcuts() {\n      let eventListeners = eventListenersMap.get(this);\n\n      eventListeners.set('keydown', listenShortcuts.bind(this, this));\n\n      document.documentElement.addEventListener('keydown', eventListeners.get('keydown'));\n\n      return this;\n   }\n\n   /**\n    * Disables the keyboard shortcuts provided\n    *\n    * @return {WebReader}\n    */\n   disableShortcuts() {\n      let eventListeners = eventListenersMap.get(this);\n\n      document.documentElement.removeEventListener('keydown', eventListeners.get('keydown'));\n      eventListeners.delete('keydown');\n\n      return this;\n   }\n\n   /**\n    * Starts the interaction with the user to receive a vocal command.\n    * If a supported command is recognized, the required action is executed.\n    *\n    * @return {Promise}\n    */\n   receiveCommand() {\n      statusMap.get(this).isInteracting = true;\n      console.debug('Interaction started');\n\n      EventEmitter.fireEvent(`${EventEmitter.namespace}.interactionstart`, document);\n\n      return this.speaker\n         .speak('Ready')\n         .then(() => this.recognizer.recognize())\n         .then(recognizedText => {\n            let translation = translations.get(this.settings.recognizer.lang);\n\n            return Commands.recognizeCommand(recognizedText, translation);\n         })\n         .then(recognizedCommand => Router.route(this, recognizedCommand))\n         .catch(error => {\n            if (error instanceof WebReaderError) {\n               return this.speaker.speak(error.message);\n            }\n\n            if (error.error !== 'aborted' && error.error !== 'interrupted') {\n               console.debug('An error occurred', error);\n\n               statusMap.set(this, Object.assign({}, defaultState));\n\n               return this.speaker.speak('Sorry, I could not recognize the command');\n            }\n         })\n         .then(// Simulate an always() method\n            () => {},\n            () => {}\n         )\n         .then(() => {\n            statusMap.get(this).isInteracting = false;\n            console.debug('Interaction completed');\n\n            EventEmitter.fireEvent(`${EventEmitter.namespace}.interactionend`, document);\n         });\n   }\n\n   /**\n    * Stops the interaction\n    */\n   stopCommand() {\n      this.recognizer.abort();\n      this.speaker.cancel();\n      statusMap.get(this).isInteracting = false;\n      console.debug('Interaction stopped');\n   }\n\n   /**\n    * Reads all the headers of a page, optionally filtered\n    *\n    * @param {Object} [filters={}] The filters to apply\n    * @param {number} [filters.level=-1] The level of the headers to read\n    * (e.g. 1 means read all and only the H1 on the page).\n    * If -1 is provided, all the headers are read\n    *\n    * @return {Promise}\n    */\n   readHeaders(filters = {}) {\n      let headers = Dom.getHeaders(filters);\n      let level = filters && filters.level ? filters.level : -1;\n\n      statusMap.get(this).elements = headers;\n\n      return headers.reduce((promise, header, index) => {\n         promise = promise.then(() => {\n            statusMap.get(this).currentIndex = index;\n            Dom.highlightElement(header);\n\n            return this.speaker\n               .speak(header.textContent + (level !== -1 ? '' : ` ${header.nodeName}`))\n               .then(() => Dom.unhighlightElement(header))\n               .catch(error => {\n                  Dom.unhighlightElement(header);\n\n                  return Promise.reject(error);\n               });\n         });\n\n         if (this.settings.delay > 0) {\n            promise = promise.then(() => Timer.wait(this.settings.delay));\n         }\n\n         return promise;\n      }, Promise.resolve());\n   }\n\n   /**\n    * Reads again the last element processed\n    *\n    * @return {Promise}\n    */\n   readCurrentElement() {\n      let state = statusMap.get(this);\n\n      if (!state.elements) {\n         return Promise.reject(new WebReaderError('There is not a current element to read'));\n      }\n\n      let element = state.elements[state.currentIndex];\n\n      Dom.highlightElement(element);\n\n      return this.speaker\n         .speak(element.textContent)\n         .then(() => Dom.unhighlightElement(element))\n         .catch(error => {\n            Dom.unhighlightElement(element);\n\n            return Promise.reject(error);\n         });\n   }\n\n   /**\n    * Reads the previous element\n    *\n    * @return {Promise}\n    */\n   readPreviousElement() {\n      let state = statusMap.get(this);\n\n      if (state.currentIndex === 0) {\n         return Promise.reject(new WebReaderError('The current element is the first'));\n      }\n\n      state.currentIndex--;\n\n      return this.readCurrentElement();\n   }\n\n   /**\n    * Reads the next element\n    *\n    * @return {Promise}\n    */\n   readNextElement() {\n      let state = statusMap.get(this);\n\n      if (state.currentIndex === state.elements.length - 1) {\n         return Promise.reject(new WebReaderError('The current element is the last'));\n      }\n\n      state.currentIndex++;\n\n      return this.readCurrentElement();\n   }\n\n   /**\n    * Follows the last read link\n    */\n   goToLink() {\n      let state = statusMap.get(this);\n      let currentElement = state.elements ? state.elements[state.currentIndex] : null;\n\n      if (!currentElement || currentElement.nodeName !== 'A') {\n         return Promise.reject(new WebReaderError('There is not a current link to follow'));\n      }\n\n      window.location.assign(currentElement.href);\n   }\n\n   /**\n    * Reads all the links of a page\n    *\n    * @param {Object} [filters={}] An object used to filters the links\n    *\n    * @return {Promise}\n    */\n   readLinks(filters) {\n      let links = Dom.getLinks(filters);\n\n      statusMap.get(this).elements = links;\n\n      return links.reduce((promise, link, index) => {\n         promise = promise.then(() => {\n            statusMap.get(this).currentIndex = index;\n\n            return this.readCurrentElement();\n         });\n\n         if (this.settings.delay > 0) {\n            promise = promise.then(() => Timer.wait(this.settings.delay));\n         }\n\n         return promise;\n      }, Promise.resolve());\n   }\n\n   /**\n    * Reads the main element of the page\n    *\n    * @return {Promise}\n    */\n   readMain() {\n      let main = Dom.getMain();\n      let state = statusMap.get(this);\n\n      state.elements = [main];\n      state.currentIndex = 0;\n\n      if (!main) {\n         return Promise.reject(new WebReaderError('The main content of this page cannot be found'));\n      }\n\n      return this.speaker.speak(main.textContent);\n   }\n\n   /**\n    * Searches the main content of the page. If the element is found, it is focused\n    */\n   searchMain() {\n      let main = Dom.getMain();\n\n      if (!main) {\n         return Promise.reject(new WebReaderError('The main content of this page cannot be found'));\n      }\n\n      let oldTabIndex = main.getAttribute('tabindex');\n\n      main.setAttribute('tabindex', -1);\n      main.addEventListener('blur', function removeTabIndex() {\n         main.removeEventListener('blur', removeTabIndex);\n\n         // Restore tabindex's old value, if any\n         if (oldTabIndex) {\n            main.setAttribute('tabindex', oldTabIndex);\n         } else {\n            main.removeAttribute('tabindex');\n         }\n      });\n      main.focus();\n   }\n\n   /**\n    * Reads the title of a page, if present or not empty\n    *\n    * @return {Promise}\n    */\n   readPageTitle() {\n      let title = Dom.getTitle();\n\n      if (title) {\n         return this.speaker.speak(`The title of the page is ${title}`);\n      } else {\n         return this.speaker.speak('This page does not have a title');\n      }\n   }\n\n   /**\n    * Reads a summary of the content of the page\n    *\n    * @return {Promise}\n    */\n   readPageSummary() {\n      let headers = Dom.getHeaders();\n      let links = Dom.getLinks();\n\n      return this.speaker.speak(`The page contains ${headers.length} headers and ${links.length} links`);\n   }\n\n   /**\n    * Goes to the previous page as specified by the browser's history\n    */\n   goToPreviousPage() {\n      window.history.back();\n   }\n\n   /**\n    * Goes to the next page as specified by the browser's history\n    */\n   goToNextPage() {\n      window.history.forward();\n   }\n\n   /**\n    * Goes to the homepage\n    */\n   goToHomepage() {\n      window.location.assign('/');\n   }\n}","import EventEmitter from '../helpers/event-emitter';\nimport WebReaderError from '../webreader-error';\n\n/**\n * @typedef SpeechRecognitionHash\n * @type {Object}\n * @property {Object[]} [grammars=[]] The collection of <code>SpeechGrammar</code> objects which represent the grammars\n * that are active for this recognition\n * @property {string} [lang=''] The language of the recognition for the request.\n * If unspecified it defaults to the language of the html document root element\n * @property {boolean} [continuous=false] Controls whether the interaction is stopped when the user stops speaking or not\n * @property {boolean} [interimResults=false] Controls whether interim results are returned or not\n * @property {number} [maxAlternatives=1] The maximum number of <code>SpeechRecognitionAlternative</code>s per result\n * @property {string} [serviceURI=''] The location of the speech recognition service to use\n *\n * @see https://dvcs.w3.org/hg/speech-api/raw-file/tip/webspeechapi.html#speechreco-attributes\n */\n\n/**\n * Retrieves the object that allows to recognize the speech or\n * <code>null</code> if the feature is not supported\n *\n * @returns {SpeechRecognition|null}\n */\nfunction getRecognizer() {\n   return window.SpeechRecognition ||\n          window.webkitSpeechRecognition ||\n          null;\n}\n\n/**\n * Binds one or more events to a <code>SpeechRecognition</code> object\n *\n * @param {SpeechRecognition} recognizer A <code>SpeechRecognition</code> object\n * @param {Object} eventsHash An object of name-function pairs,\n * where name is the event to listen and function is the function to attach\n */\nfunction bindEvents(recognizer, eventsHash) {\n   for (let eventName in eventsHash) {\n      recognizer.addEventListener(eventName, eventsHash[eventName]);\n   }\n}\n\n/**\n * Unbinds one or more events to a <code>SpeechRecognition</code> object\n *\n * @param {SpeechRecognition} recognizer A <code>SpeechRecognition</code> object\n * @param {Object} eventsHash An object of name-function pairs,\n * where name is the event to listen and function is the function to attach\n */\nfunction unbindEvents(recognizer, eventsHash) {\n   for (let eventName in eventsHash) {\n      recognizer.removeEventListener(eventName, eventsHash[eventName]);\n   }\n}\n\n/**\n * The class exposing the reading features of a web page\n *\n * @class\n */\nexport default class Recognizer {\n   /**\n    * Creates a Recognizer instance\n    *\n    * @constructor\n    *\n    * @param {SpeechRecognitionHash} [options={}] The options to customize the settings of the recognizer\n    */\n   constructor(options={}) {\n      let Recognizer = getRecognizer();\n\n      if (!Recognizer) {\n         throw Error('API not supported');\n      }\n\n      /**\n       * The speech recognizer used\n       *\n       * @type {SpeechRecognition}\n       */\n      this.recognizer = new Recognizer();\n\n      for(let key in options) {\n         if (options.hasOwnProperty(key) && this.recognizer[key] !== undefined) {\n            this.recognizer[key] = options[key];\n         }\n      }\n   }\n\n   /**\n    * Detects if the recognition feature is supported\n    *\n    * @returns {boolean}\n    */\n   static isSupported() {\n      return !!getRecognizer();\n   }\n\n   /**\n    * Starts the recognition of the speech\n    *\n    * @returns {Promise}\n    */\n   recognize() {\n      return new Promise((resolve, reject) => {\n         let recognizer = this.recognizer;\n         let eventsHash = {\n            audiostart: () => {\n               EventEmitter.fireEvent(`${EventEmitter.namespace}.recognitionstart`, document);\n            },\n            result: event => {\n               for (let i = event.resultIndex; i < event.results.length; i++) {\n                  if (event.results[i].isFinal) {\n                     let bestGuess = event.results[i][0];\n\n                     console.debug('Recognition completed');\n                     console.debug(`Recognized \"${bestGuess.transcript}\" with a confidence of ${bestGuess.confidence}`);\n\n                     EventEmitter.fireEvent(`${EventEmitter.namespace}.recognitionresult`, document, {\n                        data: {\n                           result: bestGuess\n                        }\n                     });\n\n                     resolve(bestGuess.transcript);\n                  }\n               }\n            },\n            error: event => {\n               console.debug('Recognition error:', event.error);\n\n               EventEmitter.fireEvent(`${EventEmitter.namespace}.recognitionerror`, document, {\n                  error: event.error\n               });\n\n               reject(new WebReaderError('An error has occurred while recognizing your speech'));\n            },\n            noMatch: () => {\n               console.debug('Recognition ended because of nomatch');\n\n               EventEmitter.fireEvent(`${EventEmitter.namespace}.recognitionnomatch`, document);\n\n               reject(new WebReaderError('Sorry, I could not find a match'));\n            },\n            end: () => {\n               console.debug('Recognition ended');\n\n               EventEmitter.fireEvent(`${EventEmitter.namespace}.recognitionend`, document);\n\n               unbindEvents(recognizer, eventsHash);\n\n               // If the Promise isn't resolved or rejected at this point\n               // the demo is running on Chrome and Windows 8.1 (issue #428873).\n               reject(new WebReaderError('Sorry, I could not recognize your speech'));\n            }\n         };\n\n         bindEvents(this.recognizer, eventsHash);\n\n         console.debug('Recognition started');\n         this.recognizer.start();\n      });\n   }\n\n   /**\n    * Stops listening and recognizing the speech of the user\n    */\n   abort() {\n      this.recognizer.abort();\n   }\n}","import EventEmitter from '../helpers/event-emitter';\nimport WebReaderError from '../webreader-error';\n\n/**\n * This constant is needed because Chrome doesn't fire an error event\n * if the <code>cancel()</code> method is called.\n *\n * @type {Symbol}\n */\nconst isCancelledSymbol = Symbol('isCancelled');\n\n/**\n * @typedef SpeechSynthesisUtteranceHash\n * @type {Object}\n * @property {string} text The text to be synthesized and spoken\n * @property {string} [lang=''] The language of the speech synthesis for the utterance.\n * If unspecified it defaults to the language of the html document root element\n * @property {string} [voice=''] The voice to use\n * @property {number} [volume=1.0] The speaking volume\n * @property {number} [rate=1.0] The speaking rate\n * @property {number} [pitch=1.0] The speaking pitch\n *\n * @see {@link https://dvcs.w3.org/hg/speech-api/raw-file/tip/webspeechapi.html#utterance-attributes|SpeechSynthesisUtterance Attributes}\n */\n\n/**\n * Retrieves the object that allows to speech the text or\n * <code>null</code> if the feature is not supported\n *\n * @returns {speechSynthesis|null}\n */\nfunction getSpeaker() {\n   return speechSynthesis ||\n          null;\n}\n\n/**\n * Sets the settings for a <code>SpeechSynthesisUtterance</code> object\n *\n * @param {SpeechSynthesisUtterance} utterance The object whose settings will be set\n * @param {SpeechSynthesisUtteranceHash} settings\n * @param {string[]} voices The voices available\n */\nfunction setUtteranceSettings(utterance, settings, voices) {\n   for(let key in settings) {\n      if (!settings.hasOwnProperty(key) || utterance[key] === undefined) {\n         continue;\n      }\n\n      if (key !== 'voice') {\n         utterance[key] = settings[key];\n         continue;\n      }\n\n      let voice = voices\n         .filter(voice => voice.voiceURI === settings[key])\n         .pop();\n\n      if (voice) {\n         utterance[key] = voice;\n      } else {\n         console.debug('The voice selected is not available. Falling back to one available');\n         utterance[key] = voices[0];\n      }\n   }\n}\n\n/**\n * The class exposing the speaking features of a web page\n *\n * @class\n */\nexport default class Speaker {\n   /**\n    * Creates a Speaker instance\n    *\n    * @constructor\n    *\n    * @param {SpeechSynthesisUtteranceHash} [options={}] The options to customize the voice prompting the texts\n    */\n   constructor(options = {}) {\n      /**\n       *\n       * @type {speechSynthesis|null}\n       */\n      this.speaker = getSpeaker();\n      /**\n       *\n       * @type {SpeechSynthesisUtteranceHash}\n       */\n      this.settings = options;\n      /**\n       *\n       * @type {boolean}\n       */\n      this[isCancelledSymbol] = false;\n\n      if (!this.speaker) {\n         throw Error('API not supported');\n      }\n   }\n\n   /**\n    * Detects if the speech feature is supported\n    *\n    * @returns {boolean}\n    */\n   static isSupported() {\n      return !!getSpeaker();\n   }\n\n   /**\n    * Returns the list of voices available\n    *\n    * @return {Promise}\n    */\n   getVoices() {\n      return new Promise(resolve => {\n         let voices = this.speaker.getVoices();\n\n         if (voices.length > 1) {\n            return resolve(voices);\n         } else {\n            let onVoicesChanged = function() {\n               resolve(this.speaker.getVoices());\n\n               getSpeaker().removeEventListener('voiceschanged', onVoicesChanged);\n            }.bind(this);\n\n            getSpeaker().addEventListener('voiceschanged', onVoicesChanged);\n         }\n      });\n   }\n\n   /**\n    * Prompts a text\n    *\n    * @param {string} text The text to prompt\n    *\n    * @returns {Promise}\n    */\n   speak(text) {\n      return this\n         .getVoices()\n         .then(voices => {\n            return new Promise((resolve, reject) => {\n               let utterance = new window.SpeechSynthesisUtterance(text);\n               let eventData = Object.assign({text}, this.settings);\n\n               setUtteranceSettings(utterance, this.settings, voices);\n\n               utterance.addEventListener('start', () => {\n                  console.debug(`Synthesizing the text: ${text}`);\n\n                  EventEmitter.fireEvent(`${EventEmitter.namespace}.synthesisstart`, document, {\n                     data: eventData\n                  });\n               });\n\n               utterance.addEventListener('end', () => {\n                  console.debug('Synthesis completed');\n\n                  EventEmitter.fireEvent(`${EventEmitter.namespace}.synthesisend`, document, {\n                     data: eventData\n                  });\n\n                  if (this[isCancelledSymbol]) {\n                     this[isCancelledSymbol] = false;\n                     return reject({\n                        error: 'interrupted'\n                     });\n                  }\n\n                  resolve();\n               });\n\n               utterance.addEventListener('error', event => {\n                  console.debug('Synthesis error: ', event.error);\n\n                  EventEmitter.fireEvent(`${EventEmitter.namespace}.synthesiserror`, document, {\n                     data: eventData\n                  });\n\n                  reject(new WebReaderError('An error has occurred while speaking'));\n               });\n\n               this.speaker.speak(utterance);\n            })\n         });\n   }\n\n   /**\n    * Stops the prompt of the utterance\n    */\n   cancel() {\n      this.speaker.cancel();\n      this[isCancelledSymbol] = true;\n   }\n}","import WebReaderError from './webreader-error';\n\n/**\n * The class responsible of the routing of the commands\n *\n * @class\n */\nexport\n default class Router {\n   /**\n    * Performs an action based on the command recognized\n    *\n    * @param {WebReader} webReader An instance of WebReader\n    * @param {CommandsHash} recognizedCommand The command recognized\n    *\n    * @return {Promise|WebReaderError|undefined}\n    */\n   static route(webReader, recognizedCommand) {\n      /* jshint -W074 */\n      if (recognizedCommand.command === 'READ_ALL_HEADERS') {\n         return webReader.readHeaders();\n      } else if (recognizedCommand.command === 'READ_ALL_LINKS') {\n         return webReader.readLinks();\n      } else if (recognizedCommand.command === 'READ_LEVEL_HEADERS') {\n         return webReader.readHeaders({\n            level: recognizedCommand.level\n         });\n      } else if (recognizedCommand.command === 'READ_MAIN') {\n         return webReader.readMain();\n      } else if (recognizedCommand.command === 'SEARCH_MAIN') {\n         return webReader.searchMain();\n      } else if (recognizedCommand.command === 'READ_AGAIN') {\n         return webReader.readCurrentElement();\n      } else if (recognizedCommand.command === 'READ_PREVIOUS') {\n         return webReader.readPreviousElement();\n      } else if (recognizedCommand.command === 'READ_NEXT') {\n         return webReader.readNextElement();\n      } else if (recognizedCommand.command === 'READ_PAGE_TITLE') {\n         return webReader.readPageTitle();\n      } else if (recognizedCommand.command === 'READ_LINKS_IN_ELEMENT') {\n         return webReader.readLinks({\n            ancestor: recognizedCommand.element\n         });\n      } else if (recognizedCommand.command === 'GO_TO_PREVIOUS_PAGE') {\n         return webReader.goToPreviousPage();\n      } else if (recognizedCommand.command === 'GO_TO_NEXT_PAGE') {\n         return webReader.goToNextPage();\n      } else if (recognizedCommand.command === 'READ_PAGE_SUMMARY') {\n         return webReader.readPageSummary();\n      } else if (recognizedCommand.command === 'GO_TO_HOMEPAGE') {\n         return webReader.goToHomepage();\n      } else if (recognizedCommand.command === 'GO_TO_LINK') {\n         return webReader.goToLink();\n      } else {\n         throw new WebReaderError('The command is not supported');\n      }\n   }\n}","// @TODO Extends Error. At the moment, Babel doesn't support subclassing native types\n\n/**\n * The class representing the errors thrown by WebReader\n *\n * @class\n */\nexport\n default class WebReaderError {\n   /**\n    * Creates an instance of WebReaderError\n    *\n    * @constructor\n    *\n    * @param {string} message The message of the error\n    */\n   constructor(message) {\n      /**\n       * The name of error\n       *\n       * @type {string} WebReaderError\n       */\n      this.name = this.constructor.name;\n      /**\n       * The message describing the error\n       *\n       * @type {string}\n       */\n      this.message = message;\n   }\n}"]}