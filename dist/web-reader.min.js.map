{"version":3,"sources":["node_modules/browser-pack/_prelude.js","lang/en-GB.json","main.js","node_modules/damerau-levenshtein/damerau-levenshtein.js","src/commands.js","src/dom/document.js","src/dom/dom.js","src/dom/headers.js","src/dom/links.js","src/dom/main.js","src/helpers/event-emitter.js","src/helpers/string-comparers/damerau-levenshtein-comparer.js","src/helpers/string-comparers/string-comparer.js","src/helpers/timer.js","src/main.js","src/reader/recognizer.js","src/reader/speaker.js","src/router.js","src/webreader-error.js"],"names":["f","exports","module","define","amd","g","window","global","self","this","WebReader","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length","1","commands","READ_ALL_HEADERS","text","variations","READ_ALL_LINKS","READ_LEVEL_HEADERS","levels","READ_MAIN","SEARCH_MAIN","READ_AGAIN","READ_PREVIOUS","READ_NEXT","READ_PAGE_TITLE","READ_LINKS_IN_ELEMENT","GO_TO_PREVIOUS_PAGE","GO_TO_NEXT_PAGE","READ_PAGE_SUMMARY","GO_TO_HOMEPAGE","GO_TO_LINK","elements","MAIN","selector","NAV","HEADER","FOOTER","2","DamerauLevenshtein","prices","damerau","distance","down","across","ds","split","unshift","forEach","d","j","insert","remove","Math","min","substitute","transpose","c","from","to","backward","forward","3","factory","mod","stringComparer","_stringComparer","_interopRequireDefault","obj","__esModule","default","_classCallCheck","instance","Constructor","TypeError","extractHeaderLevel","StringComparer","recognizedText","headingLevels","translation","data","regexp","RegExp","test","level","closerMatchIndex","findCloserMatch","index","findElementInText","foundElement","key","join","document","querySelector","extractElementFromText","element","closerMatches","push","closestMatch","extractData","command","Object","defineProperty","value","_stringComparer2","_extends","assign","target","arguments","source","prototype","hasOwnProperty","_createClass","defineProperties","props","descriptor","enumerable","configurable","writable","protoProps","staticProps","Commands","Comparer","get","currentTranslation","minDistance","Number","POSITIVE_INFINITY","foundCommand","toLocaleLowerCase","closerMatch","concat","./helpers/string-comparers/string-comparer","4","getTitle","title","5","headers","links","main","_document","_headers","_links","_main","highlightElement","HTMLElement","innerHTML","unhighlightElement","replace","getHeaders","getLinks","getMain","./document","./headers","./links","./main","6","getHeaderLevel","nodeName","toLowerCase","indexOf","parseInt","charAt","createHeadingsStructure","tree","recurse","headerLevel","header","subheadings","filters","undefined","filterTextRegExp","Array","querySelectorAll","filter","textContent","search","7","isScreenReaderVisible","getComputedStyle","display","getAttribute","ancestor","8","getPotentialMain","potentialMain","9","EventEmitter","eventName","namespace","properties","customEvent","createEvent","initEvent","getOwnPropertyNames","property","dispatchEvent","10","damerauLevenshtein","_damerauLevenshtein","_possibleConstructorReturn","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","_damerauLevenshtein2","DamerauLevenshteinComparer","_StringComparer","getPrototypeOf","apply","string","isArray","./string-comparer","damerau-levenshtein","11","callee","name","12","Timer","milliseconds","Promise","resolve","setTimeout","13","dom","recognizer","router","speaker","eventEmitter","damerauLevenshteinComparer","timer","webreaderError","enGB","_commands","_dom","_recognizer","_router","_speaker","_eventEmitter","_damerauLevenshteinComparer","_timer","_webreaderError","_enGB","downloadTranslation","translationsPath","language","fetch","then","response","json","translations","set","listenShortcuts","webReader","event","ctrlKey","which","isInteracting","state","statusMap","currentIndex","_dom2","stopCommand","receiveCommand","_commands2","_recognizer2","_router2","_speaker2","_eventEmitter2","_damerauLevenshteinComparer2","_timer2","_webreaderError2","_enGB2","defaultLanguage","defaults","delay","lang","voice","defaultState","eventListenersMap","WeakMap","Map","_this","options","settings","has","message","fireEvent","speak","err","eventListeners","bind","documentElement","addEventListener","removeEventListener","_this2","recognize","recognizeCommand","recognizedCommand","route","error","abort","cancel","_this3","reduce","promise","reject","wait","readCurrentElement","location","href","_this4","link","oldTabIndex","setAttribute","removeTabIndex","removeAttribute","focus","onPopState","history","back","../lang/en-GB.json","./commands","./dom/dom","./helpers/event-emitter","./helpers/string-comparers/damerau-levenshtein-comparer","./helpers/timer","./reader/recognizer","./reader/speaker","./router","./webreader-error","14","getRecognizer","SpeechRecognition","webkitSpeechRecognition","bindEvents","eventsHash","unbindEvents","dataMap","Recognizer","_Recognizer","isRecognizing","audiostart","result","resultIndex","results","isFinal","bestGuess","transcript","noMatch","end","start","../helpers/event-emitter","../webreader-error","15","getSpeaker","speechSynthesis","searchVoice","voices","voiceURI","pop","setUtteranceSettings","utterance","Speaker","isCancelled","speaking","getVoices","onVoicesChanged","SpeechSynthesisUtterance","eventData","isSpeaking","16","Router","readHeaders","readLinks","readMain","searchMain","ex","readPreviousElement","readNextElement","readPageTitle","goToPreviousPage","goToNextPage","readPageSummary","goToHomepage","goToLink","17","WebReaderError"],"mappings":"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","file":"web-reader.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","module.exports={\n   \"commands\": {\n      \"READ_ALL_HEADERS\": {\n         \"text\": \"read all headers\",\n         \"variations\": [\n            \"read headers\",\n            \"read all the headers\"\n         ]\n      },\n      \"READ_ALL_LINKS\": {\n         \"text\": \"read all links\",\n         \"variations\": [\n            \"read links\",\n            \"read all the links\"\n         ]\n      },\n      \"READ_LEVEL_HEADERS\": {\n         \"text\": \"read all h\",\n         \"variations\": [\n            \"read h\",\n            \"read all the h\"\n         ],\n         \"levels\": [\n            \"one\",\n            \"two\",\n            \"three\",\n            \"four\",\n            \"five\",\n            \"six\"\n         ]\n      },\n      \"READ_MAIN\": {\n         \"text\": \"read main content\",\n         \"variations\": [\n            \"read the main\",\n            \"read the main content\"\n         ]\n      },\n      \"SEARCH_MAIN\": {\n         \"text\": \"search main content\",\n         \"variations\": [\n            \"search the main\",\n            \"search the main content\",\n            \"find main content\",\n            \"find the main\",\n            \"find the main content\"\n         ]\n      },\n      \"READ_AGAIN\": {\n         \"text\": \"read element again\",\n         \"variations\": [\n            \"read the current element again\",\n            \"read again\"\n         ]\n      },\n      \"READ_PREVIOUS\": {\n         \"text\": \"read previous element\",\n         \"variations\": [\n            \"read previous\"\n         ]\n      },\n      \"READ_NEXT\": {\n         \"text\": \"read next element\",\n         \"variations\": [\n            \"read next\"\n         ]\n      },\n      \"READ_PAGE_TITLE\": {\n         \"text\": \"read page title\",\n         \"variations\": [\n            \"read title\",\n            \"read the title of the page\",\n            \"read document title\"\n         ]\n      },\n      \"READ_LINKS_IN_ELEMENT\": {\n         \"text\": \"read links inside\",\n         \"variations\": [\n            \"read links contained\",\n            \"read links contained in\",\n            \"read all links inside\",\n            \"read all links contained\",\n            \"read all links contained in\"\n         ]\n      },\n      \"GO_TO_PREVIOUS_PAGE\": {\n         \"text\": \"previous page\",\n         \"variations\": [\n            \"go to previous page\"\n         ]\n      },\n      \"GO_TO_NEXT_PAGE\": {\n         \"text\": \"next page\",\n         \"variations\": [\n            \"go to next page\"\n         ]\n      },\n      \"READ_PAGE_SUMMARY\": {\n         \"text\": \"read page summary\",\n         \"variations\": [\n            \"summarize page\",\n            \"summarize the page\"\n         ]\n      },\n      \"GO_TO_HOMEPAGE\": {\n         \"text\": \"homepage\",\n         \"variations\": [\n            \"go to homepage\"\n         ]\n      },\n      \"GO_TO_LINK\": {\n         \"text\": \"go to link\",\n         \"variations\": [\n            \"follow link\",\n            \"go\",\n            \"go there\"\n         ]\n      }\n   },\n   \"elements\": {\n      \"MAIN\": {\n         \"selector\": \"main\",\n         \"variations\": [\n            \"main\"\n         ]\n      },\n      \"NAV\": {\n         \"selector\": \"nav\",\n         \"variations\": [\n            \"nav\",\n            \"navigation\",\n            \"menu\"\n         ]\n      },\n      \"HEADER\": {\n         \"selector\": \"header\",\n         \"variations\": [\n            \"header\"\n         ]\n      },\n      \"FOOTER\": {\n         \"selector\": \"footer\",\n         \"variations\": [\n            \"footer\"\n         ]\n      }\n   }\n}","(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.WebReader = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\nmodule.exports={\n   \"commands\": {\n      \"READ_ALL_HEADERS\": {\n         \"text\": \"read all headers\",\n         \"variations\": [\n            \"read headers\",\n            \"read all the headers\"\n         ]\n      },\n      \"READ_ALL_LINKS\": {\n         \"text\": \"read all links\",\n         \"variations\": [\n            \"read links\",\n            \"read all the links\"\n         ]\n      },\n      \"READ_LEVEL_HEADERS\": {\n         \"text\": \"read all h\",\n         \"variations\": [\n            \"read h\",\n            \"read all the h\"\n         ],\n         \"levels\": [\n            \"one\",\n            \"two\",\n            \"three\",\n            \"four\",\n            \"five\",\n            \"six\"\n         ]\n      },\n      \"READ_MAIN\": {\n         \"text\": \"read main content\",\n         \"variations\": [\n            \"read the main\",\n            \"read the main content\"\n         ]\n      },\n      \"SEARCH_MAIN\": {\n         \"text\": \"search main content\",\n         \"variations\": [\n            \"search the main\",\n            \"search the main content\",\n            \"find main content\",\n            \"find the main\",\n            \"find the main content\"\n         ]\n      },\n      \"READ_AGAIN\": {\n         \"text\": \"read element again\",\n         \"variations\": [\n            \"read the current element again\",\n            \"read again\"\n         ]\n      },\n      \"READ_PREVIOUS\": {\n         \"text\": \"read previous element\",\n         \"variations\": [\n            \"read previous\"\n         ]\n      },\n      \"READ_NEXT\": {\n         \"text\": \"read next element\",\n         \"variations\": [\n            \"read next\"\n         ]\n      },\n      \"READ_PAGE_TITLE\": {\n         \"text\": \"read page title\",\n         \"variations\": [\n            \"read title\",\n            \"read the title of the page\",\n            \"read document title\"\n         ]\n      },\n      \"READ_LINKS_IN_ELEMENT\": {\n         \"text\": \"read links inside\",\n         \"variations\": [\n            \"read links contained\",\n            \"read links contained in\",\n            \"read all links inside\",\n            \"read all links contained\",\n            \"read all links contained in\"\n         ]\n      },\n      \"GO_TO_PREVIOUS_PAGE\": {\n         \"text\": \"previous page\",\n         \"variations\": [\n            \"go to previous page\"\n         ]\n      },\n      \"GO_TO_NEXT_PAGE\": {\n         \"text\": \"next page\",\n         \"variations\": [\n            \"go to next page\"\n         ]\n      },\n      \"READ_PAGE_SUMMARY\": {\n         \"text\": \"read page summary\",\n         \"variations\": [\n            \"summarize page\",\n            \"summarize the page\"\n         ]\n      },\n      \"GO_TO_HOMEPAGE\": {\n         \"text\": \"homepage\",\n         \"variations\": [\n            \"go to homepage\"\n         ]\n      },\n      \"GO_TO_LINK\": {\n         \"text\": \"go to link\",\n         \"variations\": [\n            \"follow link\",\n            \"go\",\n            \"go there\"\n         ]\n      }\n   },\n   \"elements\": {\n      \"MAIN\": {\n         \"selector\": \"main\",\n         \"variations\": [\n            \"main\"\n         ]\n      },\n      \"NAV\": {\n         \"selector\": \"nav\",\n         \"variations\": [\n            \"nav\",\n            \"navigation\",\n            \"menu\"\n         ]\n      },\n      \"HEADER\": {\n         \"selector\": \"header\",\n         \"variations\": [\n            \"header\"\n         ]\n      },\n      \"FOOTER\": {\n         \"selector\": \"footer\",\n         \"variations\": [\n            \"footer\"\n         ]\n      }\n   }\n}\n},{}],2:[function(require,module,exports){\nfunction DamerauLevenshtein (prices, damerau) {\n    // 'prices' customisation of the edit costs by passing an\n    // object with optional 'insert', 'remove', 'substitute', and\n    // 'transpose' keys, corresponding to either a constant\n    // number, or a function that returns the cost. The default\n    // cost for each operation is 1. The price functions take\n    // relevant character(s) as arguments, should return numbers,\n    // and have the following form:\n    //\n    // insert: function (inserted) { return NUMBER; }\n    //\n    // remove: function (removed) { return NUMBER; }\n    //\n    // substitute: function (from, to) { return NUMBER; }\n    //\n    // transpose: function (backward, forward) { return NUMBER; }\n    //\n    // The damerau flag allows us to turn off transposition and\n    // only do plain Levenshtein distance.\n\n    if (damerau !== false) damerau = true;\n    if (!prices) prices = {};\n    var insert, remove, substitute, transpose;\n\n    switch (typeof prices.insert) {\n    case 'function': insert = prices.insert; break;\n    case 'number': insert = function (c) { return prices.insert; }; break;\n    default: insert = function (c) { return 1; }; break; }\n\n    switch (typeof prices.remove) {\n    case 'function': remove = prices.remove; break;\n    case 'number': remove = function (c) { return prices.remove; }; break;\n    default: remove = function (c) { return 1; }; break; }\n\n    switch (typeof prices.substitute) {\n    case 'function': substitute = prices.substitute; break;\n    case 'number':\n        substitute = function (from, to) { return prices.substitute; };\n        break;\n    default: substitute = function (from, to) { return 1; }; break; }\n\n    switch (typeof prices.transpose) {\n    case 'function': transpose = prices.transpose; break;\n    case 'number':\n        transpose = function (backward, forward) { return prices.transpose; };\n        break;\n    default: transpose = function (backward, forward) { return 1; }; break; }\n\n    function distance(down, across) {\n        // http://en.wikipedia.org/wiki/Damerau%E2%80%93Levenshtein_distance\n        var ds = [];\n        if ( down === across ) {\n            return 0;\n        } else {\n            down = down.split(''); down.unshift(null);\n            across = across.split(''); across.unshift(null);\n            down.forEach(function (d, i) {\n                if (!ds[i]) ds[i] = [];\n                across.forEach(function (a, j) {\n                    if (i === 0 && j === 0) ds[i][j] = 0;\n                    // Empty down (i == 0) -> across[1..j] by inserting\n                    else if (i === 0) ds[i][j] = ds[i][j-1] + insert(a);\n                    // Down -> empty across (j == 0) by deleting\n                    else if (j === 0) ds[i][j] = ds[i-1][j] + remove(d);\n                    else {\n                        // Find the least costly operation that turns\n                        // the prefix down[1..i] into the prefix\n                        // across[1..j] using already calculated costs\n                        // for getting to shorter matches.\n                        ds[i][j] = Math.min(\n                            // Cost of editing down[1..i-1] to\n                            // across[1..j] plus cost of deleting\n                            // down[i] to get to down[1..i-1].\n                            ds[i-1][j] + remove(d),\n                            // Cost of editing down[1..i] to\n                            // across[1..j-1] plus cost of inserting\n                            // across[j] to get to across[1..j].\n                            ds[i][j-1] + insert(a),\n                            // Cost of editing down[1..i-1] to\n                            // across[1..j-1] plus cost of\n                            // substituting down[i] (d) with across[j]\n                            // (a) to get to across[1..j].\n                            ds[i-1][j-1] + (d === a ? 0 : substitute(d, a))\n                        );\n                        // Can we match the last two letters of down\n                        // with across by transposing them? Cost of\n                        // getting from down[i-2] to across[j-2] plus\n                        // cost of moving down[i-1] forward and\n                        // down[i] backward to match across[j-1..j].\n                        if (damerau\n                            && i > 1 && j > 1\n                            && down[i-1] === a && d === across[j-1]) {\n                            ds[i][j] = Math.min(\n                                ds[i][j],\n                                ds[i-2][j-2] + (d === a ? 0 : transpose(d, down[i-1]))\n                            );\n                        };\n                    };\n                });\n            });\n            return ds[down.length-1][across.length-1];\n        };\n    };\n    return distance;\n};\n\nmodule.exports = DamerauLevenshtein;\n\n},{}],3:[function(require,module,exports){\n(function (global, factory) {\n   if (typeof define === \"function\" && define.amd) {\n      define('WebReader', ['module', 'exports', './helpers/string-comparers/string-comparer'], factory);\n   } else if (typeof exports !== \"undefined\") {\n      factory(module, exports, require('./helpers/string-comparers/string-comparer'));\n   } else {\n      var mod = {\n         exports: {}\n      };\n      factory(mod, mod.exports, global.stringComparer);\n      global.WebReader = mod.exports;\n   }\n})(this, function (module, exports, _stringComparer) {\n   'use strict';\n\n   Object.defineProperty(exports, \"__esModule\", {\n      value: true\n   });\n\n   var _stringComparer2 = _interopRequireDefault(_stringComparer);\n\n   function _interopRequireDefault(obj) {\n      return obj && obj.__esModule ? obj : {\n         default: obj\n      };\n   }\n\n   var _extends = Object.assign || function (target) {\n      for (var i = 1; i < arguments.length; i++) {\n         var source = arguments[i];\n\n         for (var key in source) {\n            if (Object.prototype.hasOwnProperty.call(source, key)) {\n               target[key] = source[key];\n            }\n         }\n      }\n\n      return target;\n   };\n\n   function _classCallCheck(instance, Constructor) {\n      if (!(instance instanceof Constructor)) {\n         throw new TypeError(\"Cannot call a class as a function\");\n      }\n   }\n\n   var _createClass = function () {\n      function defineProperties(target, props) {\n         for (var i = 0; i < props.length; i++) {\n            var descriptor = props[i];\n            descriptor.enumerable = descriptor.enumerable || false;\n            descriptor.configurable = true;\n            if (\"value\" in descriptor) descriptor.writable = true;\n            Object.defineProperty(target, descriptor.key, descriptor);\n         }\n      }\n\n      return function (Constructor, protoProps, staticProps) {\n         if (protoProps) defineProperties(Constructor.prototype, protoProps);\n         if (staticProps) defineProperties(Constructor, staticProps);\n         return Constructor;\n      };\n   }();\n\n   /**\n    * The translation currently in use\n    *\n    * @type {Object}\n    */\n   var translation = null;\n\n   /**\n    * @typedef CommandsHash\n    * @type {Object}\n    * @property {string} command The command recognized\n    * @property {string} [translationsPath=''] The path to the translations folder\n    * @property {Object} [recognizer] The settings for the speech recognition functionality\n    */\n\n   /**\n    * Extracts the heading level contained in the string provided.\n    * If a perfect match is not found, a string comparison algorithm\n    * is used to find the closest match.\n    *\n    * @param {StringComparer} StringComparer The comparer to use for comparing strings\n    * @param {string} recognizedText The string to analyze\n    *\n    * @return {Object}\n    */\n   function extractHeaderLevel(StringComparer, recognizedText) {\n      var headingLevels = translation.commands.READ_LEVEL_HEADERS.levels;\n      var data = {};\n\n      for (var i = 0; i < headingLevels.length; i++) {\n         var regexp = new RegExp('(^|\\\\b)(' + (i + 1) + '|h' + (i + 1) + '|' + headingLevels[i] + ')(\\\\b|$)', 'i');\n\n         if (regexp.test(recognizedText)) {\n            data.level = i + 1;\n            break;\n         }\n      }\n\n      // If the header level has not been found yet,\n      // let's try a more heuristic strategy\n      if (!data.level) {\n         var closerMatchIndex = StringComparer.findCloserMatch(headingLevels, recognizedText).index;\n\n         data.level = closerMatchIndex + 1;\n      }\n\n      return data;\n   }\n\n   /**\n    * Searches an element type, such as <code>main</code> or <code>footer</code>,\n    * in the text provided. If none is found, <code>null</code> is returned\n    *\n    * @param {string} recognizedText The string to analyze\n    *\n    * @return {HTMLElement|null}\n    */\n   function findElementInText(recognizedText) {\n      var elements = translation.elements;\n      var foundElement = null;\n\n      for (var key in elements) {\n         var variations = elements[key].variations.join('|');\n         var regexp = new RegExp('(^|\\\\b)(' + variations + ')(\\\\b|$)', 'i');\n\n         if (regexp.test(recognizedText)) {\n            foundElement = document.querySelector(elements[key].selector);\n            break;\n         }\n      }\n\n      return foundElement;\n   }\n   /**\n    * Searches an element type, such as <code>main</code> or <code>footer</code>,\n    * in the text provided. If none is found, the closest match is returned\n    *\n    * @param {StringComparer} StringComparer The comparer to use for comparing strings\n    * @param {string} recognizedText The string to analyze\n    *\n    * @return {Object}\n    */\n   function extractElementFromText(StringComparer, recognizedText) {\n      var foundElement = findElementInText(recognizedText);\n\n      if (foundElement) {\n         return {\n            element: foundElement\n         };\n      }\n\n      // Collects the closer match for each element.\n      var closerMatches = [];\n      var elements = translation.elements;\n\n      // If the element has not been found yet,\n      // let's try a more heuristic strategy\n      for (var key in elements) {\n         var variations = elements[key].variations;\n         var closerMatchIndex = StringComparer.findCloserMatch(variations, recognizedText).index;\n\n         closerMatches.push(variations[closerMatchIndex]);\n      }\n\n      // Find the closest match among the closest match\n      var closestMatch = StringComparer.findCloserMatch(closerMatches, recognizedText);\n\n      return {\n         element: document.querySelector(closerMatches[closestMatch.index])\n      };\n   }\n\n   /**\n    * Extracts relevant data from a string, based on the recognized command\n    *\n    * @param {StringComparer} StringComparer The comparer to use for comparing strings\n    * @param {string} command The recognized command\n    * @param {string} recognizedText The string from which the data are extracted\n    *\n    * @return {Object}\n    */\n   function extractData(StringComparer, command, recognizedText) {\n      var data = {};\n\n      if (command === 'READ_LEVEL_HEADERS') {\n         data = extractHeaderLevel(StringComparer, recognizedText);\n      } else if (command === 'READ_LINKS_IN_ELEMENT') {\n         data = extractElementFromText(StringComparer, recognizedText);\n      }\n\n      return data;\n   }\n\n   /**\n    * The class responsible for the commands\n    *\n    * @class\n    */\n\n   var Commands = function () {\n      /**\n       * Creates an instance of Commands\n       *\n       * @constructor\n       *\n       * @param {StringComparer} Comparer The class representing the strategy to adopt to compare strings\n       */\n\n      function Commands(Comparer) {\n         _classCallCheck(this, Commands);\n\n         if (typeof Comparer !== 'function' || !(Comparer.prototype instanceof _stringComparer2.default)) {\n            throw new TypeError(arguments[0] + ' is not an instance of StringComparer');\n         }\n\n         Object.defineProperty(this, 'StringComparer', {\n            enumerable: false,\n            configurable: false,\n            get: function get() {\n               return Comparer;\n            }\n         });\n      }\n\n      /**\n       * Detects the action to perform and extracts any relevant data\n       * based on the string provided\n       *\n       * @param {string} recognizedText The string to analyze\n       * @param {Object} currentTranslation The object containing the translation of the application\n       *\n       * @return {CommandsHash}\n       */\n\n\n      _createClass(Commands, [{\n         key: 'recognizeCommand',\n         value: function recognizeCommand(recognizedText, currentTranslation) {\n            var minDistance = Number.POSITIVE_INFINITY;\n            var commands = currentTranslation.commands;\n            var foundCommand = void 0;\n\n            translation = currentTranslation;\n            recognizedText = recognizedText.toLocaleLowerCase();\n\n            for (var command in commands) {\n               var closerMatch = this.StringComparer.findCloserMatch([commands[command].text].concat(commands[command].variations), recognizedText);\n\n               if (closerMatch.distance < minDistance) {\n                  foundCommand = _extends({\n                     command: command\n                  }, extractData(this.StringComparer, command, recognizedText));\n\n                  if (closerMatch.distance === 0) {\n                     break;\n                  } else {\n                     minDistance = closerMatch.distance;\n                  }\n               }\n            }\n\n            return foundCommand;\n         }\n      }]);\n\n      return Commands;\n   }();\n\n   exports.default = Commands;\n   module.exports = exports['default'];\n});\n\n},{\"./helpers/string-comparers/string-comparer\":11}],4:[function(require,module,exports){\n(function (global, factory) {\n   if (typeof define === \"function\" && define.amd) {\n      define(\"WebReader\", [\"exports\"], factory);\n   } else if (typeof exports !== \"undefined\") {\n      factory(exports);\n   } else {\n      var mod = {\n         exports: {}\n      };\n      factory(mod.exports);\n      global.WebReader = mod.exports;\n   }\n})(this, function (exports) {\n   \"use strict\";\n\n   Object.defineProperty(exports, \"__esModule\", {\n      value: true\n   });\n   /**\n    * Returns the title of the current document\n    *\n    * @return {string}\n    */\n   function getTitle() {\n      return document.title;\n   }\n\n   exports.getTitle = getTitle;\n});\n\n},{}],5:[function(require,module,exports){\n(function (global, factory) {\n   if (typeof define === \"function\" && define.amd) {\n      define('WebReader', ['module', 'exports', './document', './headers', './links', './main'], factory);\n   } else if (typeof exports !== \"undefined\") {\n      factory(module, exports, require('./document'), require('./headers'), require('./links'), require('./main'));\n   } else {\n      var mod = {\n         exports: {}\n      };\n      factory(mod, mod.exports, global.document, global.headers, global.links, global.main);\n      global.WebReader = mod.exports;\n   }\n})(this, function (module, exports, _document, _headers, _links, _main) {\n   'use strict';\n\n   Object.defineProperty(exports, \"__esModule\", {\n      value: true\n   });\n\n\n   /**\n    * Highlights an element in the current document by wrapping it\n    * with a <code>mark</code> element\n    *\n    * @param {HTMLElement} element The element to highlight\n    */\n   function highlightElement(element) {\n      if (!(element instanceof HTMLElement)) {\n         return;\n      }\n\n      element.innerHTML = '<mark>' + element.innerHTML + '</mark>';\n   }\n\n   /**\n    * Unhighlights an element in the current document by removing\n    * the <code>mark</code> element wrapping it\n    *\n    * @param {HTMLElement} element The element to unhighlight\n    */\n   function unhighlightElement(element) {\n      if (!(element instanceof HTMLElement)) {\n         return;\n      }\n\n      element.innerHTML = element.innerHTML.replace(/^<mark>/, '').replace(/<\\/mark>$/, '');\n   }\n\n   exports.default = {\n      getHeaders: _headers.getHeaders,\n      getLinks: _links.getLinks,\n      getMain: _main.getMain,\n      getTitle: _document.getTitle,\n      highlightElement: highlightElement,\n      unhighlightElement: unhighlightElement\n   };\n   module.exports = exports['default'];\n});\n\n},{\"./document\":4,\"./headers\":6,\"./links\":7,\"./main\":8}],6:[function(require,module,exports){\n(function (global, factory) {\n   if (typeof define === \"function\" && define.amd) {\n      define('WebReader', ['exports'], factory);\n   } else if (typeof exports !== \"undefined\") {\n      factory(exports);\n   } else {\n      var mod = {\n         exports: {}\n      };\n      factory(mod.exports);\n      global.WebReader = mod.exports;\n   }\n})(this, function (exports) {\n   'use strict';\n\n   Object.defineProperty(exports, \"__esModule\", {\n      value: true\n   });\n\n   var _extends = Object.assign || function (target) {\n      for (var i = 1; i < arguments.length; i++) {\n         var source = arguments[i];\n\n         for (var key in source) {\n            if (Object.prototype.hasOwnProperty.call(source, key)) {\n               target[key] = source[key];\n            }\n         }\n      }\n\n      return target;\n   };\n\n   /**\n    * Returns the level of a header (1 for an <code>h1</code>, 2 for an <code>h2</code>,\n    * and so on). If the element is not an header or it is not defined, zero is returned\n    *\n    * @param {HTMLElement} element\n    *\n    * @return {number}\n    */\n   function getHeaderLevel(element) {\n      if (!element || !element.nodeName || element.nodeName.toLowerCase().indexOf('h') !== 0) {\n         return 0;\n      }\n\n      return parseInt(element.nodeName.charAt(1), 10);\n   }\n\n   /**\n    * Returns all the headers of a page in a tree structure. Each element\n    * possesses two properties: element and subheadings. The former\n    * is an <code>HTMLElement</code> referencing the header, while the latter is an array\n    * containing all the subheadings of the header.\n    *\n    * @param {HTMLElement[]} headers The headers to use to create the tree\n    *\n    * @return {Object[]}\n    */\n   function createHeadingsStructure(headers) {\n      var tree = [];\n\n      (function recurse(headers, index, tree) {\n         if (index.index === headers.length) {\n            return tree;\n         }\n\n         var headerLevel = getHeaderLevel(headers[index.index]);\n         var header = {\n            element: headers[index.index],\n            subheadings: []\n         };\n\n         if (tree.length === 0 || headerLevel === getHeaderLevel(tree[tree.length - 1].element)) {\n            tree.push(header);\n            index.index++;\n\n            return recurse(headers, index, tree);\n         }\n\n         if (headerLevel > getHeaderLevel(tree[tree.length - 1].element)) {\n            tree[tree.length - 1].subheadings = recurse(headers, index, []);\n         }\n\n         headerLevel = getHeaderLevel(headers[index.index]);\n\n         if (headerLevel === getHeaderLevel(tree[tree.length - 1].element)) {\n            return recurse(headers, index, tree);\n         } else {\n            return tree;\n         }\n      })(headers, {\n         index: 0\n      }, tree);\n\n      return tree;\n   }\n\n   /**\n    * Returns all the headers of a page, optionally filtered\n    *\n    * @param {Object} [filters={}] An object used to filters the headers to return\n    * @param {number} [filters.level=-1] An integer that specifies the level to retrieve.\n    * If set  to -1 retrieves all the headers\n    * @param {string} [filters.text=''] A string that must be contained in the header's text\n    *\n    * @return {HTMLElement[]}\n    */\n   function getHeaders() {\n      var filters = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n\n      var selector = void 0;\n\n      filters = _extends({\n         level: -1,\n         text: ''\n      }, filters);\n\n      if (filters.level === -1) {\n         selector = 'h1, h2, h3, h4, h5, h6';\n      } else {\n         selector = 'h' + filters.level;\n      }\n\n      var filterTextRegExp = new RegExp('(^|\\\\b)' + filters.text + '(\\\\b|$)', 'i');\n      var headers = Array.from(document.querySelectorAll(selector)).filter(function (header) {\n         return header.textContent.search(filterTextRegExp) >= 0;\n      });\n\n      return headers;\n   }\n\n   exports.createHeadingsStructure = createHeadingsStructure;\n   exports.getHeaders = getHeaders;\n});\n\n},{}],7:[function(require,module,exports){\n(function (global, factory) {\n   if (typeof define === \"function\" && define.amd) {\n      define('WebReader', ['exports'], factory);\n   } else if (typeof exports !== \"undefined\") {\n      factory(exports);\n   } else {\n      var mod = {\n         exports: {}\n      };\n      factory(mod.exports);\n      global.WebReader = mod.exports;\n   }\n})(this, function (exports) {\n   'use strict';\n\n   Object.defineProperty(exports, \"__esModule\", {\n      value: true\n   });\n\n   var _extends = Object.assign || function (target) {\n      for (var i = 1; i < arguments.length; i++) {\n         var source = arguments[i];\n\n         for (var key in source) {\n            if (Object.prototype.hasOwnProperty.call(source, key)) {\n               target[key] = source[key];\n            }\n         }\n      }\n\n      return target;\n   };\n\n   /**\n    * Determines if a link would be read or not by a classic screen reader\n    *\n    * @param {HTMLElement} element The element to test\n    *\n    * @return {boolean}\n    */\n   function isScreenReaderVisible(element) {\n      return window.getComputedStyle(element).display !== 'none' && element.getAttribute('aria-hidden') !== 'true';\n   }\n\n   /**\n    * Returns all the links of a page, optionally filtered\n    *\n    * @param {Object} [filters={}] An object used to filters the links\n    * @param {(HTMLElement|HTMLDocument)} [filters.ancestor=document] The ancestor of the links to retrieve\n    *\n    * @return {HTMLElement[]}\n    */\n   function getLinks() {\n      var filters = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n\n      filters = _extends({\n         ancestor: document\n      }, filters);\n\n      var links = filters.ancestor.querySelectorAll('a');\n\n      return Array.from(links).filter(function (element) {\n         return isScreenReaderVisible(element);\n      });\n   }\n\n   exports.getLinks = getLinks;\n});\n\n},{}],8:[function(require,module,exports){\n(function (global, factory) {\n   if (typeof define === \"function\" && define.amd) {\n      define('WebReader', ['exports'], factory);\n   } else if (typeof exports !== \"undefined\") {\n      factory(exports);\n   } else {\n      var mod = {\n         exports: {}\n      };\n      factory(mod.exports);\n      global.WebReader = mod.exports;\n   }\n})(this, function (exports) {\n   'use strict';\n\n   Object.defineProperty(exports, \"__esModule\", {\n      value: true\n   });\n   /**\n    * Searches for potential main element in the page. If only one element\n    * is found, it is returned; otherwise <code>null</code> is returned\n    *\n    * @return {HTMLElement|null}\n    */\n   function getPotentialMain() {\n      var potentialMain = document.querySelectorAll('#main-content, .main-content, #main, .main');\n\n      // If only one element is found, it's highly possible\n      // that it's the true main content of the page.\n      return potentialMain.length === 1 ? potentialMain[0] : null;\n   }\n\n   /**\n    * Returns the main element of the page.\n    * If the element is not found, an heuristic is employed to find a possible\n    * main element. If the heuristic approach fails, <code>null</code> is returned\n    *\n    * @return {HTMLElement|null}\n    */\n   function getMain() {\n      var main = document.querySelectorAll('main, [role=\"main\"]');\n\n      // If a main has not been found, let's use an heuristic to find\n      // a possible main content that has not been marked as such.\n      if (main.length === 0) {\n         main = getPotentialMain();\n      } else if (main.length > 1) {\n         main = null;\n      } else {\n         main = main[0];\n      }\n\n      return main;\n   }\n\n   exports.getMain = getMain;\n});\n\n},{}],9:[function(require,module,exports){\n(function (global, factory) {\n   if (typeof define === \"function\" && define.amd) {\n      define('WebReader', ['module', 'exports'], factory);\n   } else if (typeof exports !== \"undefined\") {\n      factory(module, exports);\n   } else {\n      var mod = {\n         exports: {}\n      };\n      factory(mod, mod.exports);\n      global.WebReader = mod.exports;\n   }\n})(this, function (module, exports) {\n   'use strict';\n\n   Object.defineProperty(exports, \"__esModule\", {\n      value: true\n   });\n\n   function _classCallCheck(instance, Constructor) {\n      if (!(instance instanceof Constructor)) {\n         throw new TypeError(\"Cannot call a class as a function\");\n      }\n   }\n\n   var _createClass = function () {\n      function defineProperties(target, props) {\n         for (var i = 0; i < props.length; i++) {\n            var descriptor = props[i];\n            descriptor.enumerable = descriptor.enumerable || false;\n            descriptor.configurable = true;\n            if (\"value\" in descriptor) descriptor.writable = true;\n            Object.defineProperty(target, descriptor.key, descriptor);\n         }\n      }\n\n      return function (Constructor, protoProps, staticProps) {\n         if (protoProps) defineProperties(Constructor.prototype, protoProps);\n         if (staticProps) defineProperties(Constructor, staticProps);\n         return Constructor;\n      };\n   }();\n\n   var EventEmitter = function () {\n      function EventEmitter() {\n         _classCallCheck(this, EventEmitter);\n      }\n\n      _createClass(EventEmitter, null, [{\n         key: 'namespaceEvent',\n         value: function namespaceEvent(eventName) {\n            return EventEmitter.namespace + '.' + eventName;\n         }\n      }, {\n         key: 'fireEvent',\n         value: function fireEvent(eventName, element) {\n            var properties = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n            var customEvent = document.createEvent('Event');\n\n            customEvent.initEvent(eventName, true, true);\n\n            Object.getOwnPropertyNames(properties).forEach(function (property) {\n               return customEvent[property] = properties[property];\n            });\n\n            element.dispatchEvent(customEvent);\n         }\n      }, {\n         key: 'namespace',\n         get: function get() {\n            return 'webreader';\n         }\n      }]);\n\n      return EventEmitter;\n   }();\n\n   exports.default = EventEmitter;\n   module.exports = exports['default'];\n});\n\n},{}],10:[function(require,module,exports){\n(function (global, factory) {\n   if (typeof define === \"function\" && define.amd) {\n      define('WebReader', ['module', 'exports', 'damerau-levenshtein', './string-comparer'], factory);\n   } else if (typeof exports !== \"undefined\") {\n      factory(module, exports, require('damerau-levenshtein'), require('./string-comparer'));\n   } else {\n      var mod = {\n         exports: {}\n      };\n      factory(mod, mod.exports, global.damerauLevenshtein, global.stringComparer);\n      global.WebReader = mod.exports;\n   }\n})(this, function (module, exports, _damerauLevenshtein, _stringComparer) {\n   'use strict';\n\n   Object.defineProperty(exports, \"__esModule\", {\n      value: true\n   });\n\n   var _damerauLevenshtein2 = _interopRequireDefault(_damerauLevenshtein);\n\n   var _stringComparer2 = _interopRequireDefault(_stringComparer);\n\n   function _interopRequireDefault(obj) {\n      return obj && obj.__esModule ? obj : {\n         default: obj\n      };\n   }\n\n   function _classCallCheck(instance, Constructor) {\n      if (!(instance instanceof Constructor)) {\n         throw new TypeError(\"Cannot call a class as a function\");\n      }\n   }\n\n   var _createClass = function () {\n      function defineProperties(target, props) {\n         for (var i = 0; i < props.length; i++) {\n            var descriptor = props[i];\n            descriptor.enumerable = descriptor.enumerable || false;\n            descriptor.configurable = true;\n            if (\"value\" in descriptor) descriptor.writable = true;\n            Object.defineProperty(target, descriptor.key, descriptor);\n         }\n      }\n\n      return function (Constructor, protoProps, staticProps) {\n         if (protoProps) defineProperties(Constructor.prototype, protoProps);\n         if (staticProps) defineProperties(Constructor, staticProps);\n         return Constructor;\n      };\n   }();\n\n   function _possibleConstructorReturn(self, call) {\n      if (!self) {\n         throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n      }\n\n      return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n   }\n\n   function _inherits(subClass, superClass) {\n      if (typeof superClass !== \"function\" && superClass !== null) {\n         throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n      }\n\n      subClass.prototype = Object.create(superClass && superClass.prototype, {\n         constructor: {\n            value: subClass,\n            enumerable: false,\n            writable: true,\n            configurable: true\n         }\n      });\n      if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n   }\n\n   var DamerauLevenshteinComparer = function (_StringComparer) {\n      _inherits(DamerauLevenshteinComparer, _StringComparer);\n\n      function DamerauLevenshteinComparer() {\n         _classCallCheck(this, DamerauLevenshteinComparer);\n\n         return _possibleConstructorReturn(this, Object.getPrototypeOf(DamerauLevenshteinComparer).apply(this, arguments));\n      }\n\n      _createClass(DamerauLevenshteinComparer, null, [{\n         key: 'findCloserMatch',\n         value: function findCloserMatch(string, target) {\n            if (!Array.isArray(string)) {\n               string = [string];\n            }\n\n            var damerauLevenshtein = (0, _damerauLevenshtein2.default)(); // jshint ignore:line\n            var minDistance = Number.POSITIVE_INFINITY;\n            var index = -1;\n\n            for (var i = 0; i < string.length; i++) {\n               var distance = damerauLevenshtein(string[i], target);\n\n               if (distance === 0 || distance < minDistance) {\n                  minDistance = distance;\n                  index = i;\n\n                  // If a perfect match is found, exit immediately\n                  if (distance === 0) {\n                     break;\n                  }\n               }\n            }\n\n            return {\n               index: index,\n               distance: minDistance\n            };\n         }\n      }]);\n\n      return DamerauLevenshteinComparer;\n   }(_stringComparer2.default);\n\n   exports.default = DamerauLevenshteinComparer;\n   module.exports = exports['default'];\n});\n\n},{\"./string-comparer\":11,\"damerau-levenshtein\":2}],11:[function(require,module,exports){\n(function (global, factory) {\n   if (typeof define === \"function\" && define.amd) {\n      define(\"WebReader\", [\"module\", \"exports\"], factory);\n   } else if (typeof exports !== \"undefined\") {\n      factory(module, exports);\n   } else {\n      var mod = {\n         exports: {}\n      };\n      factory(mod, mod.exports);\n      global.WebReader = mod.exports;\n   }\n})(this, function (module, exports) {\n   \"use strict\";\n\n   Object.defineProperty(exports, \"__esModule\", {\n      value: true\n   });\n\n   function _classCallCheck(instance, Constructor) {\n      if (!(instance instanceof Constructor)) {\n         throw new TypeError(\"Cannot call a class as a function\");\n      }\n   }\n\n   var _createClass = function () {\n      function defineProperties(target, props) {\n         for (var i = 0; i < props.length; i++) {\n            var descriptor = props[i];\n            descriptor.enumerable = descriptor.enumerable || false;\n            descriptor.configurable = true;\n            if (\"value\" in descriptor) descriptor.writable = true;\n            Object.defineProperty(target, descriptor.key, descriptor);\n         }\n      }\n\n      return function (Constructor, protoProps, staticProps) {\n         if (protoProps) defineProperties(Constructor.prototype, protoProps);\n         if (staticProps) defineProperties(Constructor, staticProps);\n         return Constructor;\n      };\n   }();\n\n   var StringComparer = function () {\n      function StringComparer() {\n         _classCallCheck(this, StringComparer);\n      }\n\n      _createClass(StringComparer, null, [{\n         key: \"findCloserMatch\",\n         value: function findCloserMatch(string, target) {\n            throw new Error(\"The \" + arguments.callee.name + \" function must be overridden\");\n         }\n      }]);\n\n      return StringComparer;\n   }();\n\n   exports.default = StringComparer;\n   module.exports = exports['default'];\n});\n\n},{}],12:[function(require,module,exports){\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define(\"WebReader\", [\"module\", \"exports\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(module, exports);\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(mod, mod.exports);\n    global.WebReader = mod.exports;\n  }\n})(this, function (module, exports) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n\n  function _classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError(\"Cannot call a class as a function\");\n    }\n  }\n\n  var _createClass = function () {\n    function defineProperties(target, props) {\n      for (var i = 0; i < props.length; i++) {\n        var descriptor = props[i];\n        descriptor.enumerable = descriptor.enumerable || false;\n        descriptor.configurable = true;\n        if (\"value\" in descriptor) descriptor.writable = true;\n        Object.defineProperty(target, descriptor.key, descriptor);\n      }\n    }\n\n    return function (Constructor, protoProps, staticProps) {\n      if (protoProps) defineProperties(Constructor.prototype, protoProps);\n      if (staticProps) defineProperties(Constructor, staticProps);\n      return Constructor;\n    };\n  }();\n\n  var Timer = function () {\n    function Timer() {\n      _classCallCheck(this, Timer);\n    }\n\n    _createClass(Timer, null, [{\n      key: \"wait\",\n      value: function wait(milliseconds) {\n        return new Promise(function (resolve) {\n          return window.setTimeout(resolve, milliseconds);\n        });\n      }\n    }]);\n\n    return Timer;\n  }();\n\n  exports.default = Timer;\n  module.exports = exports['default'];\n});\n\n},{}],13:[function(require,module,exports){\n(function (global, factory) {\n   if (typeof define === \"function\" && define.amd) {\n      define('WebReader', ['module', 'exports', './commands', './dom/dom', './reader/recognizer', './router', './reader/speaker', './helpers/event-emitter', './helpers/string-comparers/damerau-levenshtein-comparer', './helpers/timer', './webreader-error', '../lang/en-GB.json'], factory);\n   } else if (typeof exports !== \"undefined\") {\n      factory(module, exports, require('./commands'), require('./dom/dom'), require('./reader/recognizer'), require('./router'), require('./reader/speaker'), require('./helpers/event-emitter'), require('./helpers/string-comparers/damerau-levenshtein-comparer'), require('./helpers/timer'), require('./webreader-error'), require('../lang/en-GB.json'));\n   } else {\n      var mod = {\n         exports: {}\n      };\n      factory(mod, mod.exports, global.commands, global.dom, global.recognizer, global.router, global.speaker, global.eventEmitter, global.damerauLevenshteinComparer, global.timer, global.webreaderError, global.enGB);\n      global.WebReader = mod.exports;\n   }\n})(this, function (module, exports, _commands, _dom, _recognizer, _router, _speaker, _eventEmitter, _damerauLevenshteinComparer, _timer, _webreaderError, _enGB) {\n   'use strict';\n\n   Object.defineProperty(exports, \"__esModule\", {\n      value: true\n   });\n\n   var _commands2 = _interopRequireDefault(_commands);\n\n   var _dom2 = _interopRequireDefault(_dom);\n\n   var _recognizer2 = _interopRequireDefault(_recognizer);\n\n   var _router2 = _interopRequireDefault(_router);\n\n   var _speaker2 = _interopRequireDefault(_speaker);\n\n   var _eventEmitter2 = _interopRequireDefault(_eventEmitter);\n\n   var _damerauLevenshteinComparer2 = _interopRequireDefault(_damerauLevenshteinComparer);\n\n   var _timer2 = _interopRequireDefault(_timer);\n\n   var _webreaderError2 = _interopRequireDefault(_webreaderError);\n\n   var _enGB2 = _interopRequireDefault(_enGB);\n\n   function _interopRequireDefault(obj) {\n      return obj && obj.__esModule ? obj : {\n         default: obj\n      };\n   }\n\n   var _extends = Object.assign || function (target) {\n      for (var i = 1; i < arguments.length; i++) {\n         var source = arguments[i];\n\n         for (var key in source) {\n            if (Object.prototype.hasOwnProperty.call(source, key)) {\n               target[key] = source[key];\n            }\n         }\n      }\n\n      return target;\n   };\n\n   function _classCallCheck(instance, Constructor) {\n      if (!(instance instanceof Constructor)) {\n         throw new TypeError(\"Cannot call a class as a function\");\n      }\n   }\n\n   var _createClass = function () {\n      function defineProperties(target, props) {\n         for (var i = 0; i < props.length; i++) {\n            var descriptor = props[i];\n            descriptor.enumerable = descriptor.enumerable || false;\n            descriptor.configurable = true;\n            if (\"value\" in descriptor) descriptor.writable = true;\n            Object.defineProperty(target, descriptor.key, descriptor);\n         }\n      }\n\n      return function (Constructor, protoProps, staticProps) {\n         if (protoProps) defineProperties(Constructor.prototype, protoProps);\n         if (staticProps) defineProperties(Constructor, staticProps);\n         return Constructor;\n      };\n   }();\n\n   var defaultLanguage = 'en-GB';\n\n   /**\n    * @typedef SettingsHash\n    * @type {Object}\n    * @property {number} [delay=300] The delay between each spoken text\n    * @property {string} [translationsPath=''] The path to the translations folder\n    * @property {SpeechRecognitionHash} [recognizer] The settings for the speech recognition functionality\n    * @property {SpeechSynthesisUtteranceHash} [speaker] The settings for the speech synthesis functionality\n    * functionality\n    */\n\n   /**\n    * The default values for the settings available\n    *\n    * @type {SettingsHash}\n    */\n   var defaults = {\n      delay: 300,\n      translationsPath: '',\n      recognizer: {\n         lang: defaultLanguage\n      },\n      speaker: {\n         lang: defaultLanguage,\n         voice: 'Google UK English Female'\n      }\n   };\n\n   var defaultState = {\n      isInteracting: false,\n      elements: [],\n      currentIndex: -1\n   };\n\n   var eventListenersMap = new WeakMap();\n   var statusMap = new WeakMap();\n   var translations = new Map([[defaultLanguage, _enGB2.default]]);\n\n   /**\n    * Downloads a translation for the commands available\n    *\n    * @param {string} translationsPath The path to the translations folder\n    * @param {string} language The language to download\n    *\n    * @return {Promise}\n    */\n   function downloadTranslation(translationsPath, language) {\n      return window.fetch(translationsPath + '/' + language + '.json').then(function (response) {\n         return response.json();\n      }).then(function (response) {\n         translations.set(language, response);\n\n         return response;\n      });\n   }\n\n   /**\n    * Performs certain actions based on the shortcuts pressed by the user\n    *\n    * @param {WebReader} webReader An instance of WebReader\n    * @param {Event} event An event\n    */\n   function listenShortcuts(webReader, event) {\n      if (event.ctrlKey === true && (event.code && event.code === 'Space' || event.which === 32)) {\n         if (webReader.isInteracting()) {\n            var state = statusMap.get(webReader);\n            var element = state.elements[state.currentIndex];\n\n            if (element) {\n               _dom2.default.unhighlightElement(element);\n            }\n\n            webReader.stopCommand();\n         } else {\n            webReader.receiveCommand();\n         }\n      }\n   }\n\n   /**\n    * The class representing the library\n    *\n    * @class\n    */\n\n   var WebReader = function () {\n      /**\n       * Creates an instance of WebReader\n       *\n       * @constructor\n       *\n       * @param {SettingsHash} [options={}] The options to customize WebReader\n       */\n\n      function WebReader() {\n         var _this = this;\n\n         var options = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n\n         _classCallCheck(this, WebReader);\n\n         /**\n          * @type {Object}\n          */\n         this.settings = _extends({}, defaults, options);\n         /**\n          *\n          * @type {Recognizer}\n          */\n         this.recognizer = new _recognizer2.default(this.settings.recognizer);\n         /**\n          *\n          * @type {Speaker}\n          */\n         this.speaker = new _speaker2.default(this.settings.speaker);\n\n         statusMap.set(this, _extends({}, defaultState));\n         eventListenersMap.set(this, new Map());\n\n         var language = this.settings.recognizer.lang;\n\n         if (language && !translations.has(language)) {\n            downloadTranslation(this.settings.translationsPath, language).then(function () {\n               var message = 'Language \"' + language + '\" successfully loaded';\n\n               _eventEmitter2.default.fireEvent(_eventEmitter2.default.namespace + '.languagedownload', document, {\n                  data: {\n                     lang: language\n                  }\n               });\n\n               return _this.speaker.speak(message);\n            }, function (err) {\n\n               _eventEmitter2.default.fireEvent(_eventEmitter2.default.namespace + '.languageerror', document, {\n                  data: {\n                     lang: language\n                  }\n               });\n\n               return _this.speaker.speak('An error occurred: the language \"' + language + '\" was not loaded');\n            });\n         }\n      }\n\n      /**\n       * Determines if WebReader is currently interacting with the user\n       *\n       * @return {boolean}\n       */\n\n\n      _createClass(WebReader, [{\n         key: 'isInteracting',\n         value: function isInteracting() {\n            return statusMap.get(this).isInteracting;\n         }\n      }, {\n         key: 'enableShortcuts',\n         value: function enableShortcuts() {\n            var eventListeners = eventListenersMap.get(this);\n\n            eventListeners.set('keydown', listenShortcuts.bind(this, this));\n\n            document.documentElement.addEventListener('keydown', eventListeners.get('keydown'));\n\n            return this;\n         }\n      }, {\n         key: 'disableShortcuts',\n         value: function disableShortcuts() {\n            var eventListeners = eventListenersMap.get(this);\n\n            document.documentElement.removeEventListener('keydown', eventListeners.get('keydown'));\n            eventListeners.delete('keydown');\n\n            return this;\n         }\n      }, {\n         key: 'receiveCommand',\n         value: function receiveCommand() {\n            var _this2 = this;\n\n            statusMap.get(this).isInteracting = true;\n\n\n            _eventEmitter2.default.fireEvent(_eventEmitter2.default.namespace + '.interactionstart', document);\n\n            return this.speaker.speak('Ready').then(function () {\n               return _this2.recognizer.recognize();\n            }).then(function (recognizedText) {\n               var commands = new _commands2.default(_damerauLevenshteinComparer2.default);\n               var translation = translations.get(_this2.settings.recognizer.lang);\n\n               return commands.recognizeCommand(recognizedText, translation);\n            }).then(function (recognizedCommand) {\n               return _router2.default.route(_this2, recognizedCommand);\n            }).catch(function (error) {\n               if (error instanceof _webreaderError2.default) {\n                  return _this2.speaker.speak(error.message);\n               }\n\n               if (error.error !== 'aborted' && error.error !== 'interrupted') {\n\n                  statusMap.set(_this2, _extends({}, defaultState));\n\n                  return _this2.speaker.speak('Sorry, I could not recognize the command');\n               }\n            }).then( // Simulate an always() method\n            function () {}, function () {}).then(function () {\n               statusMap.get(_this2).isInteracting = false;\n\n\n               _eventEmitter2.default.fireEvent(_eventEmitter2.default.namespace + '.interactionend', document);\n            });\n         }\n      }, {\n         key: 'stopCommand',\n         value: function stopCommand() {\n            this.recognizer.abort();\n            this.speaker.cancel();\n            statusMap.get(this).isInteracting = false;\n         }\n      }, {\n         key: 'readHeaders',\n         value: function readHeaders() {\n            var _this3 = this;\n\n            var filters = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n\n            var headers = _dom2.default.getHeaders(filters);\n            var level = filters && filters.level ? filters.level : -1;\n\n            statusMap.get(this).elements = headers;\n\n            return headers.reduce(function (promise, header, index) {\n               promise = promise.then(function () {\n                  statusMap.get(_this3).currentIndex = index;\n                  _dom2.default.highlightElement(header);\n\n                  return _this3.speaker.speak(header.textContent + (level !== -1 ? '' : ' ' + header.nodeName)).then(function () {\n                     return _dom2.default.unhighlightElement(header);\n                  }).catch(function (error) {\n                     _dom2.default.unhighlightElement(header);\n\n                     return Promise.reject(error);\n                  });\n               });\n\n               if (_this3.settings.delay > 0) {\n                  promise = promise.then(function () {\n                     return _timer2.default.wait(_this3.settings.delay);\n                  });\n               }\n\n               return promise;\n            }, Promise.resolve());\n         }\n      }, {\n         key: 'readCurrentElement',\n         value: function readCurrentElement() {\n            var state = statusMap.get(this);\n            var element = state.elements[state.currentIndex];\n\n            if (!element) {\n               return Promise.reject(new _webreaderError2.default('There is not a current element to read'));\n            }\n\n            _dom2.default.highlightElement(element);\n\n            return this.speaker.speak(element.textContent).then(function () {\n               return _dom2.default.unhighlightElement(element);\n            }).catch(function (error) {\n               _dom2.default.unhighlightElement(element);\n\n               return Promise.reject(error);\n            });\n         }\n      }, {\n         key: 'readPreviousElement',\n         value: function readPreviousElement() {\n            var state = statusMap.get(this);\n\n            if (state.currentIndex === 0) {\n               return Promise.reject(new _webreaderError2.default('The current element is the first'));\n            }\n\n            state.currentIndex--;\n\n            return this.readCurrentElement();\n         }\n      }, {\n         key: 'readNextElement',\n         value: function readNextElement() {\n            var state = statusMap.get(this);\n\n            if (state.currentIndex === state.elements.length - 1) {\n               return Promise.reject(new _webreaderError2.default('The current element is the last'));\n            }\n\n            state.currentIndex++;\n\n            return this.readCurrentElement();\n         }\n      }, {\n         key: 'goToLink',\n         value: function goToLink() {\n            var state = statusMap.get(this);\n            var element = state.elements[state.currentIndex];\n\n            if (!element || element.nodeName !== 'A') {\n               throw new _webreaderError2.default('There is not a current link to follow');\n            }\n\n            window.location.assign(element.href);\n         }\n      }, {\n         key: 'readLinks',\n         value: function readLinks(filters) {\n            var _this4 = this;\n\n            var links = _dom2.default.getLinks(filters);\n\n            statusMap.get(this).elements = links;\n\n            return links.reduce(function (promise, link, index) {\n               promise = promise.then(function () {\n                  statusMap.get(_this4).currentIndex = index;\n\n                  return _this4.readCurrentElement();\n               });\n\n               if (_this4.settings.delay > 0) {\n                  promise = promise.then(function () {\n                     return _timer2.default.wait(_this4.settings.delay);\n                  });\n               }\n\n               return promise;\n            }, Promise.resolve());\n         }\n      }, {\n         key: 'readMain',\n         value: function readMain() {\n            var main = _dom2.default.getMain();\n            var state = statusMap.get(this);\n\n            if (!main) {\n               return Promise.reject(new _webreaderError2.default('The main content of this page cannot be found'));\n            } else {\n               state.elements = [main];\n               state.currentIndex = 0;\n            }\n\n            return this.speaker.speak(main.textContent);\n         }\n      }, {\n         key: 'searchMain',\n         value: function searchMain() {\n            var main = _dom2.default.getMain();\n\n            if (!main) {\n               throw new _webreaderError2.default('The main content of this page has not been found');\n            }\n\n            var oldTabIndex = main.getAttribute('tabindex');\n\n            main.setAttribute('tabindex', -1);\n            main.addEventListener('blur', function removeTabIndex() {\n               main.removeEventListener('blur', removeTabIndex);\n\n               // Restore tabindex's old value, if any\n               if (oldTabIndex) {\n                  main.setAttribute('tabindex', oldTabIndex);\n               } else {\n                  main.removeAttribute('tabindex');\n               }\n            });\n            main.focus();\n         }\n      }, {\n         key: 'readPageTitle',\n         value: function readPageTitle() {\n            var title = _dom2.default.getTitle();\n\n            if (title) {\n               return this.speaker.speak('The title of the page is ' + title);\n            } else {\n               return this.speaker.speak('This page does not have a title');\n            }\n         }\n      }, {\n         key: 'readPageSummary',\n         value: function readPageSummary() {\n            var headers = _dom2.default.getHeaders();\n            var links = _dom2.default.getLinks();\n\n            return this.speaker.speak('The page contains ' + headers.length + ' headers and ' + links.length + ' links');\n         }\n      }, {\n         key: 'goToPreviousPage',\n         value: function goToPreviousPage() {\n            return new Promise(function (resolve, reject) {\n               function onPopState() {\n                  window.removeEventListener('popstate', onPopState);\n                  resolve();\n               }\n\n               window.addEventListener('popstate', onPopState);\n               window.history.back();\n\n               // For privacy reasons a script doesn't have access to the list of pages\n               // visited by the user. So, there is no way to detect if the current page\n               // is already the first of the history. If that is the case, the\n               // \"popstate\" event won't be triggered and there is no way to know when\n               // to reject the promise (for example by checking that the current page has\n               // the same URL of the previous one).\n               //\n               // This hack allows to reject the promise if it hasn't been already resolved\n               // by the event listener for the \"popstate\" event.\n               setTimeout(function () {\n                  reject(new _webreaderError2.default('This is already the first page'));\n                  window.removeEventListener('popstate', onPopState);\n               }, 10);\n            });\n         }\n      }, {\n         key: 'goToNextPage',\n         value: function goToNextPage() {\n            return new Promise(function (resolve, reject) {\n               function onPopState() {\n                  window.removeEventListener('popstate', onPopState);\n                  resolve();\n               }\n\n               window.addEventListener('popstate', onPopState);\n               window.history.forward();\n\n               // To know the rationale behind this hack, read the comment inside\n               // the \"goToPreviousPage()\" function.\n               setTimeout(function () {\n                  reject(new _webreaderError2.default('This is already the last page'));\n                  window.removeEventListener('popstate', onPopState);\n               }, 10);\n            });\n         }\n      }, {\n         key: 'goToHomepage',\n         value: function goToHomepage() {\n            window.location.assign('/');\n         }\n      }]);\n\n      return WebReader;\n   }();\n\n   exports.default = WebReader;\n   module.exports = exports['default'];\n});\n\n},{\"../lang/en-GB.json\":1,\"./commands\":3,\"./dom/dom\":5,\"./helpers/event-emitter\":9,\"./helpers/string-comparers/damerau-levenshtein-comparer\":10,\"./helpers/timer\":12,\"./reader/recognizer\":14,\"./reader/speaker\":15,\"./router\":16,\"./webreader-error\":17}],14:[function(require,module,exports){\n(function (global, factory) {\n   if (typeof define === \"function\" && define.amd) {\n      define('WebReader', ['module', 'exports', '../helpers/event-emitter', '../webreader-error'], factory);\n   } else if (typeof exports !== \"undefined\") {\n      factory(module, exports, require('../helpers/event-emitter'), require('../webreader-error'));\n   } else {\n      var mod = {\n         exports: {}\n      };\n      factory(mod, mod.exports, global.eventEmitter, global.webreaderError);\n      global.WebReader = mod.exports;\n   }\n})(this, function (module, exports, _eventEmitter, _webreaderError) {\n   'use strict';\n\n   Object.defineProperty(exports, \"__esModule\", {\n      value: true\n   });\n\n   var _eventEmitter2 = _interopRequireDefault(_eventEmitter);\n\n   var _webreaderError2 = _interopRequireDefault(_webreaderError);\n\n   function _interopRequireDefault(obj) {\n      return obj && obj.__esModule ? obj : {\n         default: obj\n      };\n   }\n\n   function _classCallCheck(instance, Constructor) {\n      if (!(instance instanceof Constructor)) {\n         throw new TypeError(\"Cannot call a class as a function\");\n      }\n   }\n\n   var _createClass = function () {\n      function defineProperties(target, props) {\n         for (var i = 0; i < props.length; i++) {\n            var descriptor = props[i];\n            descriptor.enumerable = descriptor.enumerable || false;\n            descriptor.configurable = true;\n            if (\"value\" in descriptor) descriptor.writable = true;\n            Object.defineProperty(target, descriptor.key, descriptor);\n         }\n      }\n\n      return function (Constructor, protoProps, staticProps) {\n         if (protoProps) defineProperties(Constructor.prototype, protoProps);\n         if (staticProps) defineProperties(Constructor, staticProps);\n         return Constructor;\n      };\n   }();\n\n   /**\n    * Stores the private data of a Recognizer instance\n    *\n    * @type {WeakMap}\n    */\n   var dataMap = new WeakMap();\n\n   /**\n    * @typedef SpeechRecognitionHash\n    * @type {Object}\n    * @property {Object[]} [grammars=[]] The collection of <code>SpeechGrammar</code> objects\n    * which represent the grammars that are active for this recognition\n    * @property {string} [lang=''] The language of the recognition for the request.\n    * If unspecified it defaults to the language of the html document root element\n    * @property {boolean} [continuous=false] Controls whether the interaction is stopped when the user\n    * stops speaking or not\n    * @property {boolean} [interimResults=false] Controls whether interim results are returned or not\n    * @property {number} [maxAlternatives=1] The maximum number of <code>SpeechRecognitionAlternative</code>s per result\n    * @property {string} [serviceURI=''] The location of the speech recognition service to use\n    *\n    * @see https://dvcs.w3.org/hg/speech-api/raw-file/tip/webspeechapi.html#speechreco-attributes\n    */\n\n   /**\n    * Retrieves the object that allows to recognize the speech or\n    * <code>null</code> if the feature is not supported\n    *\n    * @returns {SpeechRecognition|null}\n    */\n   function getRecognizer() {\n      return window.SpeechRecognition || window.webkitSpeechRecognition || null;\n   }\n\n   /**\n    * Binds one or more events to a <code>SpeechRecognition</code> object\n    *\n    * @param {SpeechRecognition} recognizer A <code>SpeechRecognition</code> object\n    * @param {Object} eventsHash An object of name-function pairs,\n    * where name is the event to listen and function is the function to attach\n    */\n   function bindEvents(recognizer, eventsHash) {\n      for (var eventName in eventsHash) {\n         recognizer.addEventListener(eventName, eventsHash[eventName]);\n      }\n   }\n\n   /**\n    * Unbinds one or more events to a <code>SpeechRecognition</code> object\n    *\n    * @param {SpeechRecognition} recognizer A <code>SpeechRecognition</code> object\n    * @param {Object} eventsHash An object of name-function pairs,\n    * where name is the event to listen and function is the function to attach\n    */\n   function unbindEvents(recognizer, eventsHash) {\n      for (var eventName in eventsHash) {\n         recognizer.removeEventListener(eventName, eventsHash[eventName]);\n      }\n   }\n\n   /**\n    * The class exposing the reading features of a web page\n    *\n    * @class\n    */\n\n   var Recognizer = function () {\n      /**\n       * Creates a Recognizer instance\n       *\n       * @constructor\n       *\n       * @param {SpeechRecognitionHash} [options={}] The options to customize the settings of the recognizer\n       */\n\n      function Recognizer() {\n         var options = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n\n         _classCallCheck(this, Recognizer);\n\n         var _Recognizer = getRecognizer();\n\n         if (!_Recognizer) {\n            throw Error('API not supported');\n         }\n\n         /**\n          * The speech recognizer used\n          *\n          * @type {SpeechRecognition}\n          */\n         var recognizer = new _Recognizer();\n\n         for (var key in options) {\n            if (options.hasOwnProperty(key) && recognizer[key] !== undefined) {\n               recognizer[key] = options[key];\n            }\n         }\n\n         dataMap.set(this, {\n            recognizer: recognizer,\n            isRecognizing: false\n         });\n      }\n\n      /**\n       * Detects if the recognition feature is supported\n       *\n       * @returns {boolean}\n       */\n\n\n      _createClass(Recognizer, [{\n         key: 'isRecognizing',\n         value: function isRecognizing() {\n            return dataMap.get(this).isRecognizing;\n         }\n      }, {\n         key: 'recognize',\n         value: function recognize() {\n            var _this = this;\n\n            return new Promise(function (resolve, reject) {\n               var data = dataMap.get(_this);\n               var eventsHash = {\n                  audiostart: function audiostart() {\n                     data.isRecognizing = true;\n                     _eventEmitter2.default.fireEvent(_eventEmitter2.default.namespace + '.recognitionstart', document);\n                  },\n                  result: function result(event) {\n                     for (var i = event.resultIndex; i < event.results.length; i++) {\n                        if (event.results[i].isFinal) {\n                           var bestGuess = event.results[i][0];\n\n                           _eventEmitter2.default.fireEvent(_eventEmitter2.default.namespace + '.recognitionresult', document, {\n                              data: {\n                                 result: bestGuess\n                              }\n                           });\n\n                           data.isRecognizing = false;\n                           resolve(bestGuess.transcript);\n                        }\n                     }\n                  },\n                  error: function error(event) {\n\n                     data.isRecognizing = false;\n                     _eventEmitter2.default.fireEvent(_eventEmitter2.default.namespace + '.recognitionerror', document, {\n                        error: event.error\n                     });\n\n                     reject(new _webreaderError2.default('An error has occurred while recognizing your speech'));\n                  },\n                  noMatch: function noMatch() {\n\n                     data.isRecognizing = false;\n                     _eventEmitter2.default.fireEvent(_eventEmitter2.default.namespace + '.recognitionnomatch', document);\n\n                     reject(new _webreaderError2.default('Sorry, I could not find a match'));\n                  },\n                  end: function end() {\n\n                     data.isRecognizing = false;\n                     unbindEvents(data.recognizer, eventsHash);\n\n                     _eventEmitter2.default.fireEvent(_eventEmitter2.default.namespace + '.recognitionend', document);\n\n                     // If the Promise isn't resolved or rejected at this point\n                     // the demo is running on Chrome and Windows 8.1 (issue #428873).\n                     reject(new _webreaderError2.default('Sorry, I could not recognize your speech'));\n                  }\n               };\n\n               bindEvents(data.recognizer, eventsHash);\n\n               data.recognizer.start();\n            });\n         }\n      }, {\n         key: 'abort',\n         value: function abort() {\n            dataMap.get(this).recognizer.abort();\n         }\n      }], [{\n         key: 'isSupported',\n         value: function isSupported() {\n            return !!getRecognizer();\n         }\n      }]);\n\n      return Recognizer;\n   }();\n\n   exports.default = Recognizer;\n   module.exports = exports['default'];\n});\n\n},{\"../helpers/event-emitter\":9,\"../webreader-error\":17}],15:[function(require,module,exports){\n(function (global, factory) {\n   if (typeof define === \"function\" && define.amd) {\n      define('WebReader', ['module', 'exports', '../helpers/event-emitter', '../webreader-error'], factory);\n   } else if (typeof exports !== \"undefined\") {\n      factory(module, exports, require('../helpers/event-emitter'), require('../webreader-error'));\n   } else {\n      var mod = {\n         exports: {}\n      };\n      factory(mod, mod.exports, global.eventEmitter, global.webreaderError);\n      global.WebReader = mod.exports;\n   }\n})(this, function (module, exports, _eventEmitter, _webreaderError) {\n   'use strict';\n\n   Object.defineProperty(exports, \"__esModule\", {\n      value: true\n   });\n\n   var _eventEmitter2 = _interopRequireDefault(_eventEmitter);\n\n   var _webreaderError2 = _interopRequireDefault(_webreaderError);\n\n   function _interopRequireDefault(obj) {\n      return obj && obj.__esModule ? obj : {\n         default: obj\n      };\n   }\n\n   var _extends = Object.assign || function (target) {\n      for (var i = 1; i < arguments.length; i++) {\n         var source = arguments[i];\n\n         for (var key in source) {\n            if (Object.prototype.hasOwnProperty.call(source, key)) {\n               target[key] = source[key];\n            }\n         }\n      }\n\n      return target;\n   };\n\n   function _classCallCheck(instance, Constructor) {\n      if (!(instance instanceof Constructor)) {\n         throw new TypeError(\"Cannot call a class as a function\");\n      }\n   }\n\n   var _createClass = function () {\n      function defineProperties(target, props) {\n         for (var i = 0; i < props.length; i++) {\n            var descriptor = props[i];\n            descriptor.enumerable = descriptor.enumerable || false;\n            descriptor.configurable = true;\n            if (\"value\" in descriptor) descriptor.writable = true;\n            Object.defineProperty(target, descriptor.key, descriptor);\n         }\n      }\n\n      return function (Constructor, protoProps, staticProps) {\n         if (protoProps) defineProperties(Constructor.prototype, protoProps);\n         if (staticProps) defineProperties(Constructor, staticProps);\n         return Constructor;\n      };\n   }();\n\n   /**\n    * Stores the private data of a Speaker instance\n    *\n    * @type {WeakMap}\n    */\n   var dataMap = new WeakMap();\n\n   /**\n    * @typedef SpeechSynthesisUtteranceHash\n    * @type {Object}\n    * @property {string} text The text to be synthesized and spoken\n    * @property {string} [lang=''] The language of the speech synthesis for the utterance.\n    * If unspecified it defaults to the language of the html document root element\n    * @property {string} [voice=''] The voice to use\n    * @property {number} [volume=1.0] The speaking volume\n    * @property {number} [rate=1.0] The speaking rate\n    * @property {number} [pitch=1.0] The speaking pitch\n    *\n    * @see https://dvcs.w3.org/hg/speech-api/raw-file/tip/webspeechapi.html#utterance-attributes\n    */\n\n   /**\n    * Retrieves the object that allows to speech the text or\n    * <code>null</code> if the feature is not supported\n    *\n    * @returns {speechSynthesis|null}\n    */\n   function getSpeaker() {\n      return window.speechSynthesis || null;\n   }\n\n   /**\n    * Searches a voice among those provided\n    *\n    * @param {SpeechSynthesisUtterance[]} voices The voices available\n    * @param {string} target The voice to search\n    *\n    * @return {SpeechSynthesisUtterance|undefined}\n    */\n   function searchVoice(voices, target) {\n      return voices.filter(function (voice) {\n         return voice.voiceURI === target;\n      }).pop();\n   }\n\n   /**\n    * Sets the settings for a <code>SpeechSynthesisUtterance</code> object\n    *\n    * @param {SpeechSynthesisUtterance} utterance The object whose settings will be set\n    * @param {SpeechSynthesisUtteranceHash} settings\n    * @param {SpeechSynthesisUtterance[]} voices The voices available\n    */\n   function setUtteranceSettings(utterance, settings, voices) {\n      for (var key in settings) {\n         if (!settings.hasOwnProperty(key) || utterance[key] === undefined) {\n            continue;\n         }\n\n         if (key !== 'voice') {\n            utterance[key] = settings[key];\n            continue;\n         }\n\n         var voice = searchVoice(voices, settings[key]);\n\n         if (voice) {\n            utterance[key] = voice;\n         } else {\n            utterance[key] = voices[0];\n         }\n      }\n   }\n\n   /**\n    * The class exposing the speaking features of a web page\n    *\n    * @class\n    */\n\n   var Speaker = function () {\n      /**\n       * Creates a Speaker instance\n       *\n       * @constructor\n       *\n       * @param {SpeechSynthesisUtteranceHash} [options={}] The options to customize the voice prompting the texts\n       */\n\n      function Speaker() {\n         var options = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n\n         _classCallCheck(this, Speaker);\n\n         /**\n          *\n          * @type {speechSynthesis|null}\n          */\n         var speaker = getSpeaker();\n\n         /**\n          *\n          * @type {SpeechSynthesisUtteranceHash}\n          */\n         this.settings = options;\n\n         if (!speaker) {\n            throw Error('API not supported');\n         }\n\n         dataMap.set(this, {\n            speaker: speaker,\n            isCancelled: false\n         });\n      }\n\n      /**\n       * Detects if the speech feature is supported\n       *\n       * @returns {boolean}\n       */\n\n\n      _createClass(Speaker, [{\n         key: 'isSpeaking',\n         value: function isSpeaking() {\n            return dataMap.get(this).speaker.speaking;\n         }\n      }, {\n         key: 'getVoices',\n         value: function getVoices() {\n            var _this = this;\n\n            return new Promise(function (resolve) {\n               var speaker = dataMap.get(_this).speaker;\n               var voices = speaker.getVoices();\n\n               if (voices.length > 1) {\n                  return resolve(voices);\n               } else {\n                  speaker.addEventListener('voiceschanged', function onVoicesChanged() {\n                     speaker.removeEventListener('voiceschanged', onVoicesChanged);\n\n                     resolve(speaker.getVoices());\n                  });\n               }\n            });\n         }\n      }, {\n         key: 'speak',\n         value: function speak(text) {\n            var _this2 = this;\n\n            return this.getVoices().then(function (voices) {\n               return new Promise(function (resolve, reject) {\n                  var speaker = dataMap.get(_this2).speaker;\n                  var utterance = new window.SpeechSynthesisUtterance(text);\n                  var eventData = _extends({\n                     text: text\n                  }, _this2.settings);\n\n                  setUtteranceSettings(utterance, _this2.settings, voices);\n\n                  utterance.addEventListener('start', function () {\n\n                     _eventEmitter2.default.fireEvent(_eventEmitter2.default.namespace + '.synthesisstart', document, {\n                        data: eventData\n                     });\n                  });\n\n                  utterance.addEventListener('end', function () {\n                     var data = dataMap.get(_this2);\n\n                     _eventEmitter2.default.fireEvent(_eventEmitter2.default.namespace + '.synthesisend', document, {\n                        data: eventData\n                     });\n\n                     if (data.isCancelled) {\n                        data.isCancelled = false;\n\n                        return reject({\n                           error: 'interrupted'\n                        });\n                     }\n\n                     resolve();\n                  });\n\n                  utterance.addEventListener('error', function (event) {\n\n                     _eventEmitter2.default.fireEvent(_eventEmitter2.default.namespace + '.synthesiserror', document, {\n                        data: eventData\n                     });\n\n                     reject(new _webreaderError2.default('An error has occurred while speaking'));\n                  });\n\n                  speaker.speak(utterance);\n               });\n            });\n         }\n      }, {\n         key: 'cancel',\n         value: function cancel() {\n            var data = dataMap.get(this);\n\n            if (this.isSpeaking()) {\n               data.isCancelled = true;\n            }\n\n            data.speaker.cancel();\n         }\n      }], [{\n         key: 'isSupported',\n         value: function isSupported() {\n            return !!getSpeaker();\n         }\n      }]);\n\n      return Speaker;\n   }();\n\n   exports.default = Speaker;\n   module.exports = exports['default'];\n});\n\n},{\"../helpers/event-emitter\":9,\"../webreader-error\":17}],16:[function(require,module,exports){\n(function (global, factory) {\n   if (typeof define === \"function\" && define.amd) {\n      define('WebReader', ['module', 'exports', './webreader-error'], factory);\n   } else if (typeof exports !== \"undefined\") {\n      factory(module, exports, require('./webreader-error'));\n   } else {\n      var mod = {\n         exports: {}\n      };\n      factory(mod, mod.exports, global.webreaderError);\n      global.WebReader = mod.exports;\n   }\n})(this, function (module, exports, _webreaderError) {\n   'use strict';\n\n   Object.defineProperty(exports, \"__esModule\", {\n      value: true\n   });\n\n   var _webreaderError2 = _interopRequireDefault(_webreaderError);\n\n   function _interopRequireDefault(obj) {\n      return obj && obj.__esModule ? obj : {\n         default: obj\n      };\n   }\n\n   function _classCallCheck(instance, Constructor) {\n      if (!(instance instanceof Constructor)) {\n         throw new TypeError(\"Cannot call a class as a function\");\n      }\n   }\n\n   var _createClass = function () {\n      function defineProperties(target, props) {\n         for (var i = 0; i < props.length; i++) {\n            var descriptor = props[i];\n            descriptor.enumerable = descriptor.enumerable || false;\n            descriptor.configurable = true;\n            if (\"value\" in descriptor) descriptor.writable = true;\n            Object.defineProperty(target, descriptor.key, descriptor);\n         }\n      }\n\n      return function (Constructor, protoProps, staticProps) {\n         if (protoProps) defineProperties(Constructor.prototype, protoProps);\n         if (staticProps) defineProperties(Constructor, staticProps);\n         return Constructor;\n      };\n   }();\n\n   var Router = function () {\n      function Router() {\n         _classCallCheck(this, Router);\n      }\n\n      _createClass(Router, null, [{\n         key: 'route',\n         value: function route(webReader, recognizedCommand) {\n            /* jshint -W074 */\n            if (recognizedCommand.command === 'READ_ALL_HEADERS') {\n               return webReader.readHeaders();\n            } else if (recognizedCommand.command === 'READ_ALL_LINKS') {\n               return webReader.readLinks();\n            } else if (recognizedCommand.command === 'READ_LEVEL_HEADERS') {\n               return webReader.readHeaders({\n                  level: recognizedCommand.level\n               });\n            } else if (recognizedCommand.command === 'READ_MAIN') {\n               return webReader.readMain();\n            } else if (recognizedCommand.command === 'SEARCH_MAIN') {\n               return new Promise(function (resolve, reject) {\n                  try {\n                     resolve(webReader.searchMain());\n                  } catch (ex) {\n                     reject(ex);\n                  }\n               });\n            } else if (recognizedCommand.command === 'READ_AGAIN') {\n               return webReader.readCurrentElement();\n            } else if (recognizedCommand.command === 'READ_PREVIOUS') {\n               return webReader.readPreviousElement();\n            } else if (recognizedCommand.command === 'READ_NEXT') {\n               return webReader.readNextElement();\n            } else if (recognizedCommand.command === 'READ_PAGE_TITLE') {\n               return webReader.readPageTitle();\n            } else if (recognizedCommand.command === 'READ_LINKS_IN_ELEMENT') {\n               return webReader.readLinks({\n                  ancestor: recognizedCommand.element\n               });\n            } else if (recognizedCommand.command === 'GO_TO_PREVIOUS_PAGE') {\n               return webReader.goToPreviousPage();\n            } else if (recognizedCommand.command === 'GO_TO_NEXT_PAGE') {\n               return webReader.goToNextPage();\n            } else if (recognizedCommand.command === 'READ_PAGE_SUMMARY') {\n               return webReader.readPageSummary();\n            } else if (recognizedCommand.command === 'GO_TO_HOMEPAGE') {\n               return Promise.resolve(webReader.goToHomepage());\n            } else if (recognizedCommand.command === 'GO_TO_LINK') {\n               return new Promise(function (resolve, reject) {\n                  try {\n                     resolve(webReader.goToLink());\n                  } catch (ex) {\n                     reject(ex);\n                  }\n               });\n            } else {\n               return Promise.reject(new _webreaderError2.default('The command is not supported'));\n            }\n         }\n      }]);\n\n      return Router;\n   }();\n\n   exports.default = Router;\n   module.exports = exports['default'];\n});\n\n},{\"./webreader-error\":17}],17:[function(require,module,exports){\n(function (global, factory) {\n  if (typeof define === \"function\" && define.amd) {\n    define(\"WebReader\", [\"module\", \"exports\"], factory);\n  } else if (typeof exports !== \"undefined\") {\n    factory(module, exports);\n  } else {\n    var mod = {\n      exports: {}\n    };\n    factory(mod, mod.exports);\n    global.WebReader = mod.exports;\n  }\n})(this, function (module, exports) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n\n  function _classCallCheck(instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError(\"Cannot call a class as a function\");\n    }\n  }\n\n  var WebReaderError =\n  /**\n   * Creates an instance of WebReaderError\n   *\n   * @constructor\n   *\n   * @param {string} message The message of the error\n   */\n  function WebReaderError(message) {\n    _classCallCheck(this, WebReaderError);\n\n    /**\n     * The name of error\n     *\n     * @type {string} WebReaderError\n     */\n    this.name = this.constructor.name;\n    /**\n     * The message describing the error\n     *\n     * @type {string}\n     */\n    this.message = message;\n  };\n\n  exports.default = WebReaderError;\n  module.exports = exports['default'];\n});\n\n},{}]},{},[13])(13)\n});\n\n","function DamerauLevenshtein (prices, damerau) {\n    // 'prices' customisation of the edit costs by passing an\n    // object with optional 'insert', 'remove', 'substitute', and\n    // 'transpose' keys, corresponding to either a constant\n    // number, or a function that returns the cost. The default\n    // cost for each operation is 1. The price functions take\n    // relevant character(s) as arguments, should return numbers,\n    // and have the following form:\n    //\n    // insert: function (inserted) { return NUMBER; }\n    //\n    // remove: function (removed) { return NUMBER; }\n    //\n    // substitute: function (from, to) { return NUMBER; }\n    //\n    // transpose: function (backward, forward) { return NUMBER; }\n    //\n    // The damerau flag allows us to turn off transposition and\n    // only do plain Levenshtein distance.\n\n    if (damerau !== false) damerau = true;\n    if (!prices) prices = {};\n    var insert, remove, substitute, transpose;\n\n    switch (typeof prices.insert) {\n    case 'function': insert = prices.insert; break;\n    case 'number': insert = function (c) { return prices.insert; }; break;\n    default: insert = function (c) { return 1; }; break; }\n\n    switch (typeof prices.remove) {\n    case 'function': remove = prices.remove; break;\n    case 'number': remove = function (c) { return prices.remove; }; break;\n    default: remove = function (c) { return 1; }; break; }\n\n    switch (typeof prices.substitute) {\n    case 'function': substitute = prices.substitute; break;\n    case 'number':\n        substitute = function (from, to) { return prices.substitute; };\n        break;\n    default: substitute = function (from, to) { return 1; }; break; }\n\n    switch (typeof prices.transpose) {\n    case 'function': transpose = prices.transpose; break;\n    case 'number':\n        transpose = function (backward, forward) { return prices.transpose; };\n        break;\n    default: transpose = function (backward, forward) { return 1; }; break; }\n\n    function distance(down, across) {\n        // http://en.wikipedia.org/wiki/Damerau%E2%80%93Levenshtein_distance\n        var ds = [];\n        if ( down === across ) {\n            return 0;\n        } else {\n            down = down.split(''); down.unshift(null);\n            across = across.split(''); across.unshift(null);\n            down.forEach(function (d, i) {\n                if (!ds[i]) ds[i] = [];\n                across.forEach(function (a, j) {\n                    if (i === 0 && j === 0) ds[i][j] = 0;\n                    // Empty down (i == 0) -> across[1..j] by inserting\n                    else if (i === 0) ds[i][j] = ds[i][j-1] + insert(a);\n                    // Down -> empty across (j == 0) by deleting\n                    else if (j === 0) ds[i][j] = ds[i-1][j] + remove(d);\n                    else {\n                        // Find the least costly operation that turns\n                        // the prefix down[1..i] into the prefix\n                        // across[1..j] using already calculated costs\n                        // for getting to shorter matches.\n                        ds[i][j] = Math.min(\n                            // Cost of editing down[1..i-1] to\n                            // across[1..j] plus cost of deleting\n                            // down[i] to get to down[1..i-1].\n                            ds[i-1][j] + remove(d),\n                            // Cost of editing down[1..i] to\n                            // across[1..j-1] plus cost of inserting\n                            // across[j] to get to across[1..j].\n                            ds[i][j-1] + insert(a),\n                            // Cost of editing down[1..i-1] to\n                            // across[1..j-1] plus cost of\n                            // substituting down[i] (d) with across[j]\n                            // (a) to get to across[1..j].\n                            ds[i-1][j-1] + (d === a ? 0 : substitute(d, a))\n                        );\n                        // Can we match the last two letters of down\n                        // with across by transposing them? Cost of\n                        // getting from down[i-2] to across[j-2] plus\n                        // cost of moving down[i-1] forward and\n                        // down[i] backward to match across[j-1..j].\n                        if (damerau\n                            && i > 1 && j > 1\n                            && down[i-1] === a && d === across[j-1]) {\n                            ds[i][j] = Math.min(\n                                ds[i][j],\n                                ds[i-2][j-2] + (d === a ? 0 : transpose(d, down[i-1]))\n                            );\n                        };\n                    };\n                });\n            });\n            return ds[down.length-1][across.length-1];\n        };\n    };\n    return distance;\n};\n\nmodule.exports = DamerauLevenshtein;\n","import StringComparer from './helpers/string-comparers/string-comparer';\n\n/**\n * The translation currently in use\n *\n * @type {Object}\n */\nlet translation = null;\n\n/**\n * @typedef CommandsHash\n * @type {Object}\n * @property {string} command The command recognized\n * @property {string} [translationsPath=''] The path to the translations folder\n * @property {Object} [recognizer] The settings for the speech recognition functionality\n */\n\n/**\n * Extracts the heading level contained in the string provided.\n * If a perfect match is not found, a string comparison algorithm\n * is used to find the closest match.\n *\n * @param {StringComparer} StringComparer The comparer to use for comparing strings\n * @param {string} recognizedText The string to analyze\n *\n * @return {Object}\n */\nfunction extractHeaderLevel(StringComparer, recognizedText) {\n   const headingLevels = translation.commands.READ_LEVEL_HEADERS.levels;\n   let data = {};\n\n   for(let i = 0; i < headingLevels.length; i++) {\n      let regexp = new RegExp(`(^|\\\\b)(${i + 1}|h${i + 1}|${headingLevels[i]})(\\\\b|$)`, 'i');\n\n      if (regexp.test(recognizedText)) {\n         data.level = i + 1;\n         break;\n      }\n   }\n\n   // If the header level has not been found yet,\n   // let's try a more heuristic strategy\n   if (!data.level) {\n      let closerMatchIndex = StringComparer.findCloserMatch(headingLevels, recognizedText).index;\n\n      data.level = closerMatchIndex + 1;\n   }\n\n   return data;\n}\n\n/**\n * Searches an element type, such as <code>main</code> or <code>footer</code>,\n * in the text provided. If none is found, <code>null</code> is returned\n *\n * @param {string} recognizedText The string to analyze\n *\n * @return {HTMLElement|null}\n */\nfunction findElementInText(recognizedText) {\n   let elements = translation.elements;\n   let foundElement = null;\n\n   for(let key in elements) {\n      let variations = elements[key].variations.join('|');\n      let regexp = new RegExp(`(^|\\\\b)(${variations})(\\\\b|$)`, 'i');\n\n      if (regexp.test(recognizedText)) {\n         foundElement = document.querySelector(elements[key].selector);\n         break;\n      }\n   }\n\n   return foundElement;\n}\n/**\n * Searches an element type, such as <code>main</code> or <code>footer</code>,\n * in the text provided. If none is found, the closest match is returned\n *\n * @param {StringComparer} StringComparer The comparer to use for comparing strings\n * @param {string} recognizedText The string to analyze\n *\n * @return {Object}\n */\nfunction extractElementFromText(StringComparer, recognizedText) {\n   let foundElement = findElementInText(recognizedText);\n\n   if (foundElement) {\n      return {\n         element: foundElement\n      };\n   }\n\n   // Collects the closer match for each element.\n   let closerMatches = [];\n   let elements = translation.elements;\n\n   // If the element has not been found yet,\n   // let's try a more heuristic strategy\n   for(let key in elements) {\n      let variations = elements[key].variations;\n      let closerMatchIndex = StringComparer.findCloserMatch(variations, recognizedText).index;\n\n      closerMatches.push(variations[closerMatchIndex]);\n   }\n\n   // Find the closest match among the closest match\n   let closestMatch = StringComparer.findCloserMatch(closerMatches, recognizedText);\n\n   return {\n      element: document.querySelector(closerMatches[closestMatch.index])\n   };\n}\n\n/**\n * Extracts relevant data from a string, based on the recognized command\n *\n * @param {StringComparer} StringComparer The comparer to use for comparing strings\n * @param {string} command The recognized command\n * @param {string} recognizedText The string from which the data are extracted\n *\n * @return {Object}\n */\nfunction extractData(StringComparer, command, recognizedText) {\n   let data = {};\n\n   if (command === 'READ_LEVEL_HEADERS') {\n      console.debug('Extracting header level from text');\n      data = extractHeaderLevel(StringComparer, recognizedText);\n   } else if (command === 'READ_LINKS_IN_ELEMENT') {\n      console.debug('Extracting element from text');\n      data = extractElementFromText(StringComparer, recognizedText);\n   }\n\n   return data;\n}\n\n/**\n * The class responsible for the commands\n *\n * @class\n */\nexport\n   default class Commands {\n   /**\n    * Creates an instance of Commands\n    *\n    * @constructor\n    *\n    * @param {StringComparer} Comparer The class representing the strategy to adopt to compare strings\n    */\n   constructor(Comparer) {\n      if (typeof Comparer !== 'function' || !(Comparer.prototype instanceof StringComparer)) {\n         throw new TypeError(`${arguments[0]} is not an instance of StringComparer`);\n      }\n\n      Object.defineProperty(this, 'StringComparer', {\n         enumerable: false,\n         configurable: false,\n         get: function() {\n            return Comparer;\n         }\n      });\n   }\n\n   /**\n    * Detects the action to perform and extracts any relevant data\n    * based on the string provided\n    *\n    * @param {string} recognizedText The string to analyze\n    * @param {Object} currentTranslation The object containing the translation of the application\n    *\n    * @return {CommandsHash}\n    */\n   recognizeCommand(recognizedText, currentTranslation) {\n      let minDistance = Number.POSITIVE_INFINITY;\n      let commands = currentTranslation.commands;\n      let foundCommand;\n\n      translation = currentTranslation;\n      recognizedText = recognizedText.toLocaleLowerCase();\n\n      console.debug('Command recognition started');\n\n      for(let command in commands) {\n         let closerMatch = this.StringComparer.findCloserMatch(\n            [commands[command].text].concat(commands[command].variations),\n            recognizedText\n         );\n\n         if (closerMatch.distance < minDistance) {\n            foundCommand = Object.assign({\n               command\n            }, extractData(this.StringComparer, command, recognizedText));\n\n            if (closerMatch.distance === 0) {\n               break;\n            } else {\n               minDistance = closerMatch.distance;\n            }\n         }\n      }\n\n      console.debug(`Command recognition ended. Found command \"${commands[foundCommand.command].text}\"`);\n      console.debug('Extrapolated data:', foundCommand);\n\n      return foundCommand;\n   }\n}","/**\n * Returns the title of the current document\n *\n * @return {string}\n */\nfunction getTitle() {\n   return document.title;\n}\n\nexport {\n   getTitle\n};","import {getTitle} from './document';\nimport {getHeaders} from './headers';\nimport {getLinks} from './links';\nimport {getMain} from './main';\n\n/**\n * Highlights an element in the current document by wrapping it\n * with a <code>mark</code> element\n *\n * @param {HTMLElement} element The element to highlight\n */\nfunction highlightElement(element) {\n   if (!(element instanceof HTMLElement)) {\n      return;\n   }\n\n   element.innerHTML = `<mark>${element.innerHTML}</mark>`;\n}\n\n/**\n * Unhighlights an element in the current document by removing\n * the <code>mark</code> element wrapping it\n *\n * @param {HTMLElement} element The element to unhighlight\n */\nfunction unhighlightElement(element) {\n   if (!(element instanceof HTMLElement)) {\n      return;\n   }\n\n   element.innerHTML = element.innerHTML\n      .replace(/^<mark>/, '')\n      .replace(/<\\/mark>$/, '');\n}\n\nexport\n default {\n   getHeaders,\n   getLinks,\n   getMain,\n   getTitle,\n   highlightElement,\n   unhighlightElement\n};","/**\n * Returns the level of a header (1 for an <code>h1</code>, 2 for an <code>h2</code>,\n * and so on). If the element is not an header or it is not defined, zero is returned\n *\n * @param {HTMLElement} element\n *\n * @return {number}\n */\nfunction getHeaderLevel(element) {\n   if (!element || !element.nodeName || element.nodeName.toLowerCase().indexOf('h') !== 0) {\n      return 0;\n   }\n\n   return parseInt(element.nodeName.charAt(1), 10);\n}\n\n/**\n * Returns all the headers of a page in a tree structure. Each element\n * possesses two properties: element and subheadings. The former\n * is an <code>HTMLElement</code> referencing the header, while the latter is an array\n * containing all the subheadings of the header.\n *\n * @param {HTMLElement[]} headers The headers to use to create the tree\n *\n * @return {Object[]}\n */\nfunction createHeadingsStructure(headers) {\n   let tree = [];\n\n   (function recurse(headers, index, tree) {\n      if (index.index === headers.length) {\n         return tree;\n      }\n\n      let headerLevel = getHeaderLevel(headers[index.index]);\n      let header = {\n         element: headers[index.index],\n         subheadings: []\n      };\n\n      if (tree.length === 0 || headerLevel === getHeaderLevel(tree[tree.length - 1].element)) {\n         tree.push(header);\n         index.index++;\n\n         return recurse(headers, index, tree);\n      }\n\n      if (headerLevel > getHeaderLevel(tree[tree.length - 1].element)) {\n         tree[tree.length - 1].subheadings = recurse(headers, index, []);\n      }\n\n      headerLevel = getHeaderLevel(headers[index.index]);\n\n      if (headerLevel === getHeaderLevel(tree[tree.length - 1].element)) {\n         return recurse(headers, index, tree);\n      } else {\n         return tree;\n      }\n   })(headers, {\n      index: 0\n   }, tree);\n\n   return tree;\n}\n\n/**\n * Returns all the headers of a page, optionally filtered\n *\n * @param {Object} [filters={}] An object used to filters the headers to return\n * @param {number} [filters.level=-1] An integer that specifies the level to retrieve.\n * If set  to -1 retrieves all the headers\n * @param {string} [filters.text=''] A string that must be contained in the header's text\n *\n * @return {HTMLElement[]}\n */\nfunction getHeaders(filters = {}) {\n   let selector;\n\n   filters = Object.assign(\n      {\n         level: -1,\n         text: ''\n      },\n      filters\n   );\n\n   if (filters.level === -1) {\n      selector = 'h1, h2, h3, h4, h5, h6';\n   } else {\n      selector = `h${filters.level}`;\n   }\n\n   let filterTextRegExp = new RegExp(`(^|\\\\b)${filters.text}(\\\\b|$)`, 'i');\n   let headers = Array\n      .from(document.querySelectorAll(selector))\n      .filter(header => header.textContent.search(filterTextRegExp) >= 0);\n\n   return headers;\n}\n\nexport {\n   createHeadingsStructure,\n   getHeaders\n};","/**\n * Determines if a link would be read or not by a classic screen reader\n *\n * @param {HTMLElement} element The element to test\n *\n * @return {boolean}\n */\nfunction isScreenReaderVisible(element) {\n   return window.getComputedStyle(element).display !== 'none' &&\n          element.getAttribute('aria-hidden') !== 'true';\n}\n\n/**\n * Returns all the links of a page, optionally filtered\n *\n * @param {Object} [filters={}] An object used to filters the links\n * @param {(HTMLElement|HTMLDocument)} [filters.ancestor=document] The ancestor of the links to retrieve\n *\n * @return {HTMLElement[]}\n */\nfunction getLinks(filters = {}) {\n   filters = Object.assign(\n      {\n         ancestor: document\n      },\n      filters\n   );\n\n   let links = filters.ancestor.querySelectorAll('a');\n\n   return Array\n      .from(links)\n      .filter(element => isScreenReaderVisible(element));\n}\n\nexport {\n   getLinks\n};","/**\n * Searches for potential main element in the page. If only one element\n * is found, it is returned; otherwise <code>null</code> is returned\n *\n * @return {HTMLElement|null}\n */\nfunction getPotentialMain() {\n   let potentialMain = document.querySelectorAll('#main-content, .main-content, #main, .main');\n\n   // If only one element is found, it's highly possible\n   // that it's the true main content of the page.\n   return potentialMain.length === 1 ? potentialMain[0] : null;\n}\n\n/**\n * Returns the main element of the page.\n * If the element is not found, an heuristic is employed to find a possible\n * main element. If the heuristic approach fails, <code>null</code> is returned\n *\n * @return {HTMLElement|null}\n */\nfunction getMain() {\n   let main = document.querySelectorAll('main, [role=\"main\"]');\n\n   // If a main has not been found, let's use an heuristic to find\n   // a possible main content that has not been marked as such.\n   if (main.length === 0) {\n      main = getPotentialMain();\n   } else if (main.length > 1) {\n      main = null;\n   } else {\n      main = main[0];\n   }\n\n   return main;\n}\n\nexport {\n   getMain\n};","/**\n * The class representing an event emitter\n *\n * @class\n */\nexport\n   default class EventEmitter {\n   /**\n    * Returns the namespace of the events\n    *\n    * @return {string}\n    */\n   static get namespace() {\n      return 'webreader';\n   }\n\n   /**\n    * Namespaces an event\n    *\n    * @param {string} eventName The event name\n    *\n    * @return {string}\n    */\n   static namespaceEvent(eventName) {\n      return `${EventEmitter.namespace}.${eventName}`;\n   }\n\n   /**\n    * Fires an event\n    *\n    * @param {string} eventName The name of the event\n    * @param {HTMLElement|Document} element The element on which the event is dispatched\n    * @param {Object} [properties={}] A set of key-values to assign to the event\n    */\n   static fireEvent(eventName, element, properties = {}) {\n      let customEvent = document.createEvent('Event');\n\n      customEvent.initEvent(eventName, true, true);\n\n      Object\n         .getOwnPropertyNames(properties)\n         .forEach(property => customEvent[property] = properties[property]);\n\n      element.dispatchEvent(customEvent);\n   }\n}","import DamerauLevenshtein from 'damerau-levenshtein';\nimport StringComparer from './string-comparer';\n\n/**\n * The class representing a comparer using the Damerau-Levenshtein algorithm\n *\n * @class\n */\nexport\n   default class DamerauLevenshteinComparer extends StringComparer {\n   /**\n    * Finds the closest match of a string using the Damerau-Levenshtein algorithm\n    *\n    * @param {(string|string[])} string The string or the array of strings to test\n    * @param {string} target The string to test against\n    *\n    * @return {Object}\n    */\n   static findCloserMatch(string, target) {\n      if (!Array.isArray(string)) {\n         string = [string];\n      }\n\n      let damerauLevenshtein = DamerauLevenshtein(); // jshint ignore:line\n      let minDistance = Number.POSITIVE_INFINITY;\n      let index = -1;\n\n      for(let i = 0; i < string.length; i++) {\n         let distance = damerauLevenshtein(string[i], target);\n\n         console.debug(`The distance between \"${string[i]}\" and \"${target}\" is ${distance}`);\n\n         if (distance === 0 || distance < minDistance) {\n            minDistance = distance;\n            index = i;\n\n            // If a perfect match is found, exit immediately\n            if (distance === 0) {\n               break;\n            }\n         }\n      }\n\n      return {\n         index: index,\n         distance: minDistance\n      };\n   }\n}","/**\n * An interface representing a string comparer\n *\n * @interface\n */\nexport\n   default class StringComparer {\n      /**\n       * Finds the closest match of a string\n       *\n       * @abstract\n       *\n       * @param {(string|string[])} string The string or the array of strings to test\n       * @param {string} target The string to test against\n       *\n       * @return {Object}\n       */\n      /* jshint ignore:start */\n      static findCloserMatch(string, target) {\n         throw new Error(`The ${arguments.callee.name} function must be overridden`);\n      }\n      /* jshint ignore:end */\n   }\n","/**\n * The class representing a timer\n *\n * @class\n */\nexport\n   default class Timer {\n   /**\n    * Waits for the amount of milliseconds specified\n    *\n    * @param {number} milliseconds The amount of milliseconds to wait\n    *\n    * @return {Promise}\n    */\n   static wait(milliseconds) {\n      return new Promise(resolve => window.setTimeout(resolve, milliseconds));\n   }\n}","import Commands from './commands';\nimport Dom from './dom/dom';\nimport Recognizer from './reader/recognizer';\nimport Router from './router';\nimport Speaker from './reader/speaker';\nimport EventEmitter from './helpers/event-emitter';\nimport DamerauLevenshteinComparer from './helpers/string-comparers/damerau-levenshtein-comparer';\nimport Timer from './helpers/timer';\nimport WebReaderError from './webreader-error';\nimport defaultTranslation from '../lang/en-GB.json';\n\nconst defaultLanguage = 'en-GB';\n\n/**\n * @typedef SettingsHash\n * @type {Object}\n * @property {number} [delay=300] The delay between each spoken text\n * @property {string} [translationsPath=''] The path to the translations folder\n * @property {SpeechRecognitionHash} [recognizer] The settings for the speech recognition functionality\n * @property {SpeechSynthesisUtteranceHash} [speaker] The settings for the speech synthesis functionality\n * functionality\n */\n\n/**\n * The default values for the settings available\n *\n * @type {SettingsHash}\n */\nconst defaults = {\n   delay: 300,\n   translationsPath: '',\n   recognizer: {\n      lang: defaultLanguage\n   },\n   speaker: {\n      lang: defaultLanguage,\n      voice: 'Google UK English Female'\n   }\n};\n\nconst defaultState = {\n   isInteracting: false,\n   elements: [],\n   currentIndex: -1\n};\n\nlet eventListenersMap = new WeakMap();\nlet statusMap = new WeakMap();\nlet translations = new Map([[defaultLanguage, defaultTranslation]]);\n\n/**\n * Downloads a translation for the commands available\n *\n * @param {string} translationsPath The path to the translations folder\n * @param {string} language The language to download\n *\n * @return {Promise}\n */\nfunction downloadTranslation(translationsPath, language) {\n   return window\n      .fetch(`${translationsPath}/${language}.json`)\n      .then(response => response.json())\n      .then(response => {\n         translations.set(language, response);\n\n         return response;\n      });\n}\n\n/**\n * Performs certain actions based on the shortcuts pressed by the user\n *\n * @param {WebReader} webReader An instance of WebReader\n * @param {Event} event An event\n */\nfunction listenShortcuts(webReader, event) {\n   if (\n      event.ctrlKey === true &&\n      (event.code && event.code === 'Space' || event.which === 32)\n   ) {\n      if (webReader.isInteracting()) {\n         let state = statusMap.get(webReader);\n         let element = state.elements[state.currentIndex];\n\n         if (element) {\n            Dom.unhighlightElement(element);\n         }\n\n         webReader.stopCommand();\n      } else {\n         webReader.receiveCommand();\n      }\n   }\n}\n\n/**\n * The class representing the library\n *\n * @class\n */\nexport\n   default class WebReader {\n   /**\n    * Creates an instance of WebReader\n    *\n    * @constructor\n    *\n    * @param {SettingsHash} [options={}] The options to customize WebReader\n    */\n   constructor(options = {}) {\n      /**\n       * @type {Object}\n       */\n      this.settings = Object.assign({}, defaults, options);\n      /**\n       *\n       * @type {Recognizer}\n       */\n      this.recognizer = new Recognizer(this.settings.recognizer);\n      /**\n       *\n       * @type {Speaker}\n       */\n      this.speaker = new Speaker(this.settings.speaker);\n\n      statusMap.set(this, Object.assign({}, defaultState));\n      eventListenersMap.set(this, new Map());\n\n      let language = this.settings.recognizer.lang;\n\n      if (language && !translations.has(language)) {\n         downloadTranslation(this.settings.translationsPath, language)\n            .then(\n               () => {\n                  let message = `Language \"${language}\" successfully loaded`;\n\n                  console.debug(message);\n\n                  EventEmitter.fireEvent(`${EventEmitter.namespace}.languagedownload`, document, {\n                     data: {\n                        lang: language\n                     }\n                  });\n\n                  return this.speaker.speak(message);\n               },\n               err => {\n                  console.debug(err.message);\n\n                  EventEmitter.fireEvent(`${EventEmitter.namespace}.languageerror`, document, {\n                     data: {\n                        lang: language\n                     }\n                  });\n\n                  return this.speaker.speak(`An error occurred: the language \"${language}\" was not loaded`);\n               }\n            );\n      }\n   }\n\n   /**\n    * Determines if WebReader is currently interacting with the user\n    *\n    * @return {boolean}\n    */\n   isInteracting() {\n      return statusMap.get(this).isInteracting;\n   }\n\n   /**\n    * Enables the keyboard shortcuts provided\n    *\n    * @return {WebReader}\n    */\n   enableShortcuts() {\n      let eventListeners = eventListenersMap.get(this);\n\n      eventListeners.set('keydown', listenShortcuts.bind(this, this));\n\n      document.documentElement.addEventListener('keydown', eventListeners.get('keydown'));\n\n      return this;\n   }\n\n   /**\n    * Disables the keyboard shortcuts provided\n    *\n    * @return {WebReader}\n    */\n   disableShortcuts() {\n      let eventListeners = eventListenersMap.get(this);\n\n      document.documentElement.removeEventListener('keydown', eventListeners.get('keydown'));\n      eventListeners.delete('keydown');\n\n      return this;\n   }\n\n   /**\n    * Starts the interaction with the user to receive a vocal command.\n    * If a supported command is recognized, the required action is executed.\n    *\n    * @return {Promise}\n    */\n   receiveCommand() {\n      statusMap.get(this).isInteracting = true;\n      console.debug('Interaction started');\n\n      EventEmitter.fireEvent(`${EventEmitter.namespace}.interactionstart`, document);\n\n      return this.speaker\n         .speak('Ready')\n         .then(() => this.recognizer.recognize())\n         .then(recognizedText => {\n            let commands = new Commands(DamerauLevenshteinComparer);\n            let translation = translations.get(this.settings.recognizer.lang);\n\n            return commands.recognizeCommand(recognizedText, translation);\n         })\n         .then(recognizedCommand => Router.route(this, recognizedCommand))\n         .catch(error => {\n            if (error instanceof WebReaderError) {\n               return this.speaker.speak(error.message);\n            }\n\n            if (error.error !== 'aborted' && error.error !== 'interrupted') {\n               console.debug('An error occurred', error);\n\n               statusMap.set(this, Object.assign({}, defaultState));\n\n               return this.speaker.speak('Sorry, I could not recognize the command');\n            }\n         })\n         .then(// Simulate an always() method\n            () => {},\n            () => {}\n         )\n         .then(() => {\n            statusMap.get(this).isInteracting = false;\n            console.debug('Interaction completed');\n\n            EventEmitter.fireEvent(`${EventEmitter.namespace}.interactionend`, document);\n         });\n   }\n\n   /**\n    * Stops the interaction\n    */\n   stopCommand() {\n      this.recognizer.abort();\n      this.speaker.cancel();\n      statusMap.get(this).isInteracting = false;\n      console.debug('Interaction stopped');\n   }\n\n   /**\n    * Reads all the headers of a page, optionally filtered\n    *\n    * @param {Object} [filters={}] The filters to apply\n    * @param {number} [filters.level=-1] The level of the headers to read\n    * (e.g. 1 means read all and only the H1 on the page).\n    * If -1 is provided, all the headers are read\n    *\n    * @return {Promise}\n    */\n   readHeaders(filters = {}) {\n      let headers = Dom.getHeaders(filters);\n      let level = filters && filters.level ? filters.level : -1;\n\n      statusMap.get(this).elements = headers;\n\n      return headers.reduce((promise, header, index) => {\n         promise = promise.then(() => {\n            statusMap.get(this).currentIndex = index;\n            Dom.highlightElement(header);\n\n            return this.speaker\n               .speak(header.textContent + (level !== -1 ? '' : ` ${header.nodeName}`))\n               .then(() => Dom.unhighlightElement(header))\n               .catch(error => {\n                  Dom.unhighlightElement(header);\n\n                  return Promise.reject(error);\n               });\n         });\n\n         if (this.settings.delay > 0) {\n            promise = promise.then(() => Timer.wait(this.settings.delay));\n         }\n\n         return promise;\n      }, Promise.resolve());\n   }\n\n   /**\n    * Reads again the last element processed\n    *\n    * @return {Promise}\n    */\n   readCurrentElement() {\n      let state = statusMap.get(this);\n      let element = state.elements[state.currentIndex];\n\n      if (!element) {\n         return Promise.reject(new WebReaderError('There is not a current element to read'));\n      }\n\n      Dom.highlightElement(element);\n\n      return this.speaker\n         .speak(element.textContent)\n         .then(() => Dom.unhighlightElement(element))\n         .catch(error => {\n            Dom.unhighlightElement(element);\n\n            return Promise.reject(error);\n         });\n   }\n\n   /**\n    * Reads the previous element\n    *\n    * @return {Promise}\n    */\n   readPreviousElement() {\n      let state = statusMap.get(this);\n\n      if (state.currentIndex === 0) {\n         return Promise.reject(new WebReaderError('The current element is the first'));\n      }\n\n      state.currentIndex--;\n\n      return this.readCurrentElement();\n   }\n\n   /**\n    * Reads the next element\n    *\n    * @return {Promise}\n    */\n   readNextElement() {\n      let state = statusMap.get(this);\n\n      if (state.currentIndex === state.elements.length - 1) {\n         return Promise.reject(new WebReaderError('The current element is the last'));\n      }\n\n      state.currentIndex++;\n\n      return this.readCurrentElement();\n   }\n\n   /**\n    * Follows the last read link\n    *\n    * @throws {WebReaderError} the current element is not a link\n    */\n   goToLink() {\n      let state = statusMap.get(this);\n      let element = state.elements[state.currentIndex];\n\n      if (!element || element.nodeName !== 'A') {\n         throw new WebReaderError('There is not a current link to follow');\n      }\n\n      window.location.assign(element.href);\n   }\n\n   /**\n    * Reads all the links of a page\n    *\n    * @param {Object} [filters={}] An object used to filters the links\n    * @param {(HTMLElement|HTMLDocument)} [filters.ancestor=document] The ancestor of the links to retrieve\n    *\n    * @return {Promise}\n    */\n   readLinks(filters) {\n      let links = Dom.getLinks(filters);\n\n      statusMap.get(this).elements = links;\n\n      return links.reduce((promise, link, index) => {\n         promise = promise.then(() => {\n            statusMap.get(this).currentIndex = index;\n\n            return this.readCurrentElement();\n         });\n\n         if (this.settings.delay > 0) {\n            promise = promise.then(() => Timer.wait(this.settings.delay));\n         }\n\n         return promise;\n      }, Promise.resolve());\n   }\n\n   /**\n    * Reads the main element of the page\n    *\n    * @return {Promise}\n    */\n   readMain() {\n      let main = Dom.getMain();\n      let state = statusMap.get(this);\n\n      if (!main) {\n         return Promise.reject(new WebReaderError('The main content of this page cannot be found'));\n      } else {\n         state.elements = [main];\n         state.currentIndex = 0;\n      }\n\n      return this.speaker.speak(main.textContent);\n   }\n\n   /**\n    * Searches the main content of the page. If the element is found, it is focused\n    *\n    * @throws {WebReaderError} main content is not found\n    */\n   searchMain() {\n      let main = Dom.getMain();\n\n      if (!main) {\n         throw new WebReaderError('The main content of this page has not been found');\n      }\n\n      let oldTabIndex = main.getAttribute('tabindex');\n\n      main.setAttribute('tabindex', -1);\n      main.addEventListener('blur', function removeTabIndex() {\n         main.removeEventListener('blur', removeTabIndex);\n\n         // Restore tabindex's old value, if any\n         if (oldTabIndex) {\n            main.setAttribute('tabindex', oldTabIndex);\n         } else {\n            main.removeAttribute('tabindex');\n         }\n      });\n      main.focus();\n   }\n\n   /**\n    * Reads the title of a page, if present or not empty\n    *\n    * @return {Promise}\n    */\n   readPageTitle() {\n      let title = Dom.getTitle();\n\n      if (title) {\n         return this.speaker.speak(`The title of the page is ${title}`);\n      } else {\n         return this.speaker.speak('This page does not have a title');\n      }\n   }\n\n   /**\n    * Reads a summary of the content of the page\n    *\n    * @return {Promise}\n    */\n   readPageSummary() {\n      let headers = Dom.getHeaders();\n      let links = Dom.getLinks();\n\n      return this.speaker.speak(`The page contains ${headers.length} headers and ${links.length} links`);\n   }\n\n   /**\n    * Goes to the previous page as specified by the browser's history\n    *\n    * @return {Promise}\n    */\n   goToPreviousPage() {\n      return new Promise((resolve, reject) => {\n         function onPopState() {\n            window.removeEventListener('popstate', onPopState);\n            resolve();\n         }\n\n         window.addEventListener('popstate', onPopState);\n         window.history.back();\n\n         // For privacy reasons a script doesn't have access to the list of pages\n         // visited by the user. So, there is no way to detect if the current page\n         // is already the first of the history. If that is the case, the\n         // \"popstate\" event won't be triggered and there is no way to know when\n         // to reject the promise (for example by checking that the current page has\n         // the same URL of the previous one).\n         //\n         // This hack allows to reject the promise if it hasn't been already resolved\n         // by the event listener for the \"popstate\" event.\n         setTimeout(() => {\n            reject(new WebReaderError('This is already the first page'));\n            window.removeEventListener('popstate', onPopState);\n         }, 10);\n      });\n   }\n\n   /**\n    * Goes to the next page as specified by the browser's history\n    *\n    * @return {Promise}\n    */\n   goToNextPage() {\n      return new Promise((resolve, reject) => {\n         function onPopState() {\n            window.removeEventListener('popstate', onPopState);\n            resolve();\n         }\n\n         window.addEventListener('popstate', onPopState);\n         window.history.forward();\n\n         // To know the rationale behind this hack, read the comment inside\n         // the \"goToPreviousPage()\" function.\n         setTimeout(() => {\n            reject(new WebReaderError('This is already the last page'));\n            window.removeEventListener('popstate', onPopState);\n         }, 10);\n      });\n   }\n\n   /**\n    * Goes to the homepage\n    */\n   goToHomepage() {\n      window.location.assign('/');\n   }\n}","import EventEmitter from '../helpers/event-emitter';\nimport WebReaderError from '../webreader-error';\n\n/**\n * Stores the private data of a Recognizer instance\n *\n * @type {WeakMap}\n */\nlet dataMap = new WeakMap();\n\n/**\n * @typedef SpeechRecognitionHash\n * @type {Object}\n * @property {Object[]} [grammars=[]] The collection of <code>SpeechGrammar</code> objects\n * which represent the grammars that are active for this recognition\n * @property {string} [lang=''] The language of the recognition for the request.\n * If unspecified it defaults to the language of the html document root element\n * @property {boolean} [continuous=false] Controls whether the interaction is stopped when the user\n * stops speaking or not\n * @property {boolean} [interimResults=false] Controls whether interim results are returned or not\n * @property {number} [maxAlternatives=1] The maximum number of <code>SpeechRecognitionAlternative</code>s per result\n * @property {string} [serviceURI=''] The location of the speech recognition service to use\n *\n * @see https://dvcs.w3.org/hg/speech-api/raw-file/tip/webspeechapi.html#speechreco-attributes\n */\n\n/**\n * Retrieves the object that allows to recognize the speech or\n * <code>null</code> if the feature is not supported\n *\n * @returns {SpeechRecognition|null}\n */\nfunction getRecognizer() {\n   return window.SpeechRecognition ||\n          window.webkitSpeechRecognition ||\n          null;\n}\n\n/**\n * Binds one or more events to a <code>SpeechRecognition</code> object\n *\n * @param {SpeechRecognition} recognizer A <code>SpeechRecognition</code> object\n * @param {Object} eventsHash An object of name-function pairs,\n * where name is the event to listen and function is the function to attach\n */\nfunction bindEvents(recognizer, eventsHash) {\n   for(let eventName in eventsHash) {\n      recognizer.addEventListener(eventName, eventsHash[eventName]);\n   }\n}\n\n/**\n * Unbinds one or more events to a <code>SpeechRecognition</code> object\n *\n * @param {SpeechRecognition} recognizer A <code>SpeechRecognition</code> object\n * @param {Object} eventsHash An object of name-function pairs,\n * where name is the event to listen and function is the function to attach\n */\nfunction unbindEvents(recognizer, eventsHash) {\n   for(let eventName in eventsHash) {\n      recognizer.removeEventListener(eventName, eventsHash[eventName]);\n   }\n}\n\n/**\n * The class exposing the reading features of a web page\n *\n * @class\n */\nexport\n default class Recognizer {\n   /**\n    * Creates a Recognizer instance\n    *\n    * @constructor\n    *\n    * @param {SpeechRecognitionHash} [options={}] The options to customize the settings of the recognizer\n    */\n   constructor(options={}) {\n      let Recognizer = getRecognizer();\n\n      if (!Recognizer) {\n         throw Error('API not supported');\n      }\n\n      /**\n       * The speech recognizer used\n       *\n       * @type {SpeechRecognition}\n       */\n      let recognizer = new Recognizer();\n\n      for(let key in options) {\n         if (options.hasOwnProperty(key) && recognizer[key] !== undefined) {\n            recognizer[key] = options[key];\n         }\n      }\n\n      dataMap.set(this, {\n         recognizer: recognizer,\n         isRecognizing: false\n      });\n   }\n\n   /**\n    * Detects if the recognition feature is supported\n    *\n    * @returns {boolean}\n    */\n   static isSupported() {\n      return !!getRecognizer();\n   }\n\n   /**\n    * Determines if the recognizer is recognizing a speech\n    *\n    * @return {boolean}\n    */\n   isRecognizing() {\n      return dataMap\n         .get(this)\n         .isRecognizing;\n   }\n\n   /**\n    * Starts the recognition of the speech\n    *\n    * @returns {Promise}\n    */\n   recognize() {\n      return new Promise((resolve, reject) => {\n         let data = dataMap.get(this);\n         let eventsHash = {\n            audiostart: () => {\n               data.isRecognizing = true;\n               EventEmitter.fireEvent(`${EventEmitter.namespace}.recognitionstart`, document);\n            },\n            result: event => {\n               for(let i = event.resultIndex; i < event.results.length; i++) {\n                  if (event.results[i].isFinal) {\n                     let bestGuess = event.results[i][0];\n\n                     console.debug('Recognition completed');\n                     console.debug(`Recognized \"${bestGuess.transcript}\" with a confidence of ${bestGuess.confidence}`);\n\n                     EventEmitter.fireEvent(`${EventEmitter.namespace}.recognitionresult`, document, {\n                        data: {\n                           result: bestGuess\n                        }\n                     });\n\n                     data.isRecognizing = false;\n                     resolve(bestGuess.transcript);\n                  }\n               }\n            },\n            error: event => {\n               console.debug('Recognition error:', event.error);\n\n               data.isRecognizing = false;\n               EventEmitter.fireEvent(`${EventEmitter.namespace}.recognitionerror`, document, {\n                  error: event.error\n               });\n\n               reject(new WebReaderError('An error has occurred while recognizing your speech'));\n            },\n            noMatch: () => {\n               console.debug('Recognition ended because of nomatch');\n\n               data.isRecognizing = false;\n               EventEmitter.fireEvent(`${EventEmitter.namespace}.recognitionnomatch`, document);\n\n               reject(new WebReaderError('Sorry, I could not find a match'));\n            },\n            end: () => {\n               console.debug('Recognition ended');\n\n               data.isRecognizing = false;\n               unbindEvents(data.recognizer, eventsHash);\n\n               EventEmitter.fireEvent(`${EventEmitter.namespace}.recognitionend`, document);\n\n               // If the Promise isn't resolved or rejected at this point\n               // the demo is running on Chrome and Windows 8.1 (issue #428873).\n               reject(new WebReaderError('Sorry, I could not recognize your speech'));\n            }\n         };\n\n         bindEvents(data.recognizer, eventsHash);\n\n         console.debug('Recognition started');\n         data.recognizer.start();\n      });\n   }\n\n   /**\n    * Stops listening and recognizing the speech of the user\n    */\n   abort() {\n      dataMap\n         .get(this)\n         .recognizer\n         .abort();\n   }\n}","import EventEmitter from '../helpers/event-emitter';\nimport WebReaderError from '../webreader-error';\n\n/**\n * Stores the private data of a Speaker instance\n *\n * @type {WeakMap}\n */\nlet dataMap = new WeakMap();\n\n/**\n * @typedef SpeechSynthesisUtteranceHash\n * @type {Object}\n * @property {string} text The text to be synthesized and spoken\n * @property {string} [lang=''] The language of the speech synthesis for the utterance.\n * If unspecified it defaults to the language of the html document root element\n * @property {string} [voice=''] The voice to use\n * @property {number} [volume=1.0] The speaking volume\n * @property {number} [rate=1.0] The speaking rate\n * @property {number} [pitch=1.0] The speaking pitch\n *\n * @see https://dvcs.w3.org/hg/speech-api/raw-file/tip/webspeechapi.html#utterance-attributes\n */\n\n/**\n * Retrieves the object that allows to speech the text or\n * <code>null</code> if the feature is not supported\n *\n * @returns {speechSynthesis|null}\n */\nfunction getSpeaker() {\n   return window.speechSynthesis ||\n          null;\n}\n\n/**\n * Searches a voice among those provided\n *\n * @param {SpeechSynthesisUtterance[]} voices The voices available\n * @param {string} target The voice to search\n *\n * @return {SpeechSynthesisUtterance|undefined}\n */\nfunction searchVoice(voices, target) {\n   return voices\n      .filter(voice => voice.voiceURI === target)\n      .pop();\n}\n\n/**\n * Sets the settings for a <code>SpeechSynthesisUtterance</code> object\n *\n * @param {SpeechSynthesisUtterance} utterance The object whose settings will be set\n * @param {SpeechSynthesisUtteranceHash} settings\n * @param {SpeechSynthesisUtterance[]} voices The voices available\n */\nfunction setUtteranceSettings(utterance, settings, voices) {\n   for(let key in settings) {\n      if (!settings.hasOwnProperty(key) || utterance[key] === undefined) {\n         continue;\n      }\n\n      if (key !== 'voice') {\n         utterance[key] = settings[key];\n         continue;\n      }\n\n      let voice = searchVoice(voices, settings[key]);\n\n      if (voice) {\n         utterance[key] = voice;\n      } else {\n         console.debug('The voice selected is not available. Falling back to one available');\n         utterance[key] = voices[0];\n      }\n   }\n}\n\n/**\n * The class exposing the speaking features of a web page\n *\n * @class\n */\nexport\n default class Speaker {\n   /**\n    * Creates a Speaker instance\n    *\n    * @constructor\n    *\n    * @param {SpeechSynthesisUtteranceHash} [options={}] The options to customize the voice prompting the texts\n    */\n   constructor(options = {}) {\n      /**\n       *\n       * @type {speechSynthesis|null}\n       */\n      let speaker = getSpeaker();\n\n      /**\n       *\n       * @type {SpeechSynthesisUtteranceHash}\n       */\n      this.settings = options;\n\n      if (!speaker) {\n         throw Error('API not supported');\n      }\n\n      dataMap.set(this, {\n         speaker: speaker,\n         isCancelled: false\n      });\n   }\n\n   /**\n    * Detects if the speech feature is supported\n    *\n    * @returns {boolean}\n    */\n   static isSupported() {\n      return !!getSpeaker();\n   }\n\n   /**\n    * Determines if a text is being prompted\n    *\n    * @return {boolean}\n    */\n   isSpeaking() {\n      return dataMap\n         .get(this)\n         .speaker\n         .speaking;\n   }\n\n   /**\n    * Returns the list of voices available\n    *\n    * @return {Promise}\n    */\n   getVoices() {\n      return new Promise(resolve => {\n         let speaker = dataMap.get(this).speaker;\n         let voices = speaker.getVoices();\n\n         if (voices.length > 1) {\n            return resolve(voices);\n         } else {\n            speaker.addEventListener('voiceschanged', function onVoicesChanged() {\n               speaker.removeEventListener('voiceschanged', onVoicesChanged);\n\n               resolve(speaker.getVoices());\n            });\n         }\n      });\n   }\n\n   /**\n    * Prompts a text\n    *\n    * @param {string} text The text to prompt\n    *\n    * @returns {Promise}\n    */\n   speak(text) {\n      return this\n         .getVoices()\n         .then(voices => {\n            return new Promise((resolve, reject) => {\n               let speaker = dataMap.get(this).speaker;\n               let utterance = new window.SpeechSynthesisUtterance(text);\n               let eventData = Object.assign({\n                  text\n               }, this.settings);\n\n               setUtteranceSettings(utterance, this.settings, voices);\n\n               utterance.addEventListener('start', () => {\n                  console.debug(`Synthesizing the text: ${text}`);\n\n                  EventEmitter.fireEvent(`${EventEmitter.namespace}.synthesisstart`, document, {\n                     data: eventData\n                  });\n               });\n\n               utterance.addEventListener('end', () => {\n                  let data = dataMap.get(this);\n\n                  console.debug('Synthesis completed');\n\n                  EventEmitter.fireEvent(`${EventEmitter.namespace}.synthesisend`, document, {\n                     data: eventData\n                  });\n\n                  if (data.isCancelled) {\n                     data.isCancelled = false;\n\n                     return reject({\n                        error: 'interrupted'\n                     });\n                  }\n\n                  resolve();\n               });\n\n               utterance.addEventListener('error', event => {\n                  console.debug('Synthesis error: ', event.error);\n\n                  EventEmitter.fireEvent(`${EventEmitter.namespace}.synthesiserror`, document, {\n                     data: eventData\n                  });\n\n                  reject(new WebReaderError('An error has occurred while speaking'));\n               });\n\n               speaker.speak(utterance);\n            });\n         });\n   }\n\n   /**\n    * Stops the prompt of the utterance and cleans the queue of the texts to prompt\n    */\n   cancel() {\n      let data = dataMap.get(this);\n\n      if (this.isSpeaking()) {\n         data.isCancelled = true;\n      }\n\n      data.speaker.cancel();\n   }\n}","import WebReaderError from './webreader-error';\n\n/**\n * The class responsible of the routing of the commands\n *\n * @class\n */\nexport\n default class Router {\n   /**\n    * Performs an action based on the command recognized\n    *\n    * @param {WebReader} webReader An instance of WebReader\n    * @param {CommandsHash} recognizedCommand The command recognized\n    *\n    * @return {Promise}\n    */\n   static route(webReader, recognizedCommand) {\n      /* jshint -W074 */\n      if (recognizedCommand.command === 'READ_ALL_HEADERS') {\n         return webReader.readHeaders();\n      } else if (recognizedCommand.command === 'READ_ALL_LINKS') {\n         return webReader.readLinks();\n      } else if (recognizedCommand.command === 'READ_LEVEL_HEADERS') {\n         return webReader.readHeaders({\n            level: recognizedCommand.level\n         });\n      } else if (recognizedCommand.command === 'READ_MAIN') {\n         return webReader.readMain();\n      } else if (recognizedCommand.command === 'SEARCH_MAIN') {\n         return new Promise((resolve, reject) => {\n            try {\n               resolve(webReader.searchMain());\n            } catch(ex) {\n               reject(ex);\n            }\n         });\n      } else if (recognizedCommand.command === 'READ_AGAIN') {\n         return webReader.readCurrentElement();\n      } else if (recognizedCommand.command === 'READ_PREVIOUS') {\n         return webReader.readPreviousElement();\n      } else if (recognizedCommand.command === 'READ_NEXT') {\n         return webReader.readNextElement();\n      } else if (recognizedCommand.command === 'READ_PAGE_TITLE') {\n         return webReader.readPageTitle();\n      } else if (recognizedCommand.command === 'READ_LINKS_IN_ELEMENT') {\n         return webReader.readLinks({\n            ancestor: recognizedCommand.element\n         });\n      } else if (recognizedCommand.command === 'GO_TO_PREVIOUS_PAGE') {\n         return webReader.goToPreviousPage();\n      } else if (recognizedCommand.command === 'GO_TO_NEXT_PAGE') {\n         return webReader.goToNextPage();\n      } else if (recognizedCommand.command === 'READ_PAGE_SUMMARY') {\n         return webReader.readPageSummary();\n      } else if (recognizedCommand.command === 'GO_TO_HOMEPAGE') {\n         return Promise.resolve(webReader.goToHomepage());\n      } else if (recognizedCommand.command === 'GO_TO_LINK') {\n         return new Promise((resolve, reject) => {\n            try {\n               resolve(webReader.goToLink());\n            } catch(ex) {\n               reject(ex);\n            }\n         });\n      } else {\n         return Promise.reject(new WebReaderError('The command is not supported'));\n      }\n   }\n}","// @TODO Extends Error. At the moment, Babel doesn't support subclassing native types\n\n/**\n * The class representing the errors thrown by WebReader\n *\n * @class\n */\nexport\n default class WebReaderError {\n   /**\n    * Creates an instance of WebReaderError\n    *\n    * @constructor\n    *\n    * @param {string} message The message of the error\n    */\n   constructor(message) {\n      /**\n       * The name of error\n       *\n       * @type {string} WebReaderError\n       */\n      this.name = this.constructor.name;\n      /**\n       * The message describing the error\n       *\n       * @type {string}\n       */\n      this.message = message;\n   }\n}"],"sourceRoot":"/source/"}